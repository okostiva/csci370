/*v8419: 2013-02-20T15:46:40*/
var $j={get_root_namespace:function(){return"$j"},namespace:function(){var c=arguments,h=this,f=0,e,g,b;for(;f<c.length;f++){b=c[f];if(b.indexOf(".")){g=b.split(".");for(e=(g[0]==this.get_root_namespace())?1:0;e<g.length;e++){h[g[e]]=h[g[e]]||{};h=h[g[e]]}}else{h[b]=h[b]||{}}}return h}};(function(){var a=false,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(g){var f=this.prototype;a=true;var e=new this();a=false;for(var d in g){e[d]=typeof g[d]=="function"&&typeof f[d]=="function"&&b.test(g[d])?(function(h,i){return function(){var k=this._super;this._super=f[h];var j=i.apply(this,arguments);this._super=k;return j}})(d,g[d]):g[d]}function c(){if(!a&&this._construct){this._construct.apply(this,arguments)}}c.prototype=e;c.constructor=c;c.extend=arguments.callee;return c}})();(function(f){function d(){}function v(F){c=[F]}function o(H,F,G){return H&&H.apply(F.context||F,G)}function n(F){return/\?/.test(F)?"&":"?"}var p="async",t="charset",r="",D="error",u="insertBefore",s="_jqjsp",A="on",g=A+"click",k=A+D,q=A+"load",y=A+"readystatechange",b="readyState",C="removeChild",j="<script>",z="success",B="timeout",e=window,a=f.Deferred,h=f("head")[0]||document.documentElement,x={},m=0,c,l={callback:s,url:location.href},w=e.opera,i=!!f("<div>").html("<!--[if IE]><i><![endif]-->").find("i").length;function E(K){K=f.extend({},l,K);var I=K.success,P=K.error,H=K.complete,Y=K.dataFilter,aa=K.callbackParameter,Q=K.callback,Z=K.cache,G=K.pageCache,J=K.charset,L=K.url,ac=K.data,S=K.timeout,O,W=0,U=d,R,N,F,ab,M,V;a&&a(function(ad){ad.done(I).fail(P);I=ad.resolve;P=ad.reject}).promise(K);K.abort=function(){!(W++)&&U()};if(o(K.beforeSend,K,[K])===!1||W){return K}L=L||r;ac=ac?((typeof ac)=="string"?ac:f.param(ac,K.traditional)):r;L+=ac?(n(L)+ac):r;aa&&(L+=n(L)+encodeURIComponent(aa)+"=?");!Z&&!G&&(L+=n(L)+"_"+(new Date()).getTime()+"=");L=L.replace(/=\?(&|$)/,"="+Q+"$1");function X(ad){if(!(W++)){U();G&&(x[L]={s:[ad]});Y&&(ad=Y.apply(K,[ad]));o(I,K,[ad,z,K]);o(H,K,[K,z])}}function T(ad){if(!(W++)){U();G&&ad!=B&&(x[L]=ad);o(P,K,[K,ad]);o(H,K,[K,ad])}}if(G&&(O=x[L])){O.s?X(O.s[0]):T(O)}else{e[Q]=v;ab=f(j)[0];ab.id=s+m++;if(J){ab[t]=J}w&&w.version()<11.6?((M=f(j)[0]).text="document.getElementById('"+ab.id+"')."+k+"()"):(ab[p]=p);if(i){ab.htmlFor=ab.id;ab.event=g}ab[q]=ab[k]=ab[y]=function(ad){if(!ab[b]||!/i/.test(ab[b])){try{ab[g]&&ab[g]()}catch(ae){}ad=c;c=0;ad?X(ad[0]):T(D)}};ab.src=L;U=function(ad){V&&clearTimeout(V);ab[y]=ab[q]=ab[k]=null;h[C](ab);M&&h[C](M)};h[u](ab,(F=h.firstChild));M&&h[u](M,F);V=S>0&&setTimeout(function(){T(B)},S)}return K}E.setup=function(F){f.extend(l,F)};f.jsonp=E})(jQuery);(function(b){var a=false;$j.JengaWidget=function(d,c){this.$root=null;this.options={};this._className=null;this._instanceId=null;this._mxInits=[];this._isInitialized=false;this._isRendered=false;this._construct=function(f,e){this._instanceId=$j.util.uid();this._className=e;this._createRootNode(f)};this.isRendered=function(){return this._isRendered};this.init=function(e){this._setOptions(e);this._initRootNode();this._globalInit();for(var f=0;f<this._mxInits.length;f++){(this._mxInits[f]).call(this)}this._widgetInit();this._isInitialized=true;this.refresh()};this._globalInit=function(){if(!a){this._loadGlobalCSS()}a=true};this._widgetInit=function(){};this.registerMixin=function(e,g){var h=this.init;delete this.init;e.call(this);if(this.init){var f=this.init;this._mxInits.push(function(){f.call(this,g)});delete this.init}else{}this.init=h};this.refresh=function(){var e=this;$j.session.ready(function(){e._render.call(e);e._isRendered=true})};this._render=function(){};this.empty=function(){this.$root.empty()};this.getInstanceId=function(){return this._instanceId};this.getWidgetId=function(){return this.getWidgetClass()+"_"+this.getInstanceId()};this.getWidgetClass=function(){return this._className};this.getAssetClass=function(){return this._className};this.updateOptions=function(e){this._setOptions(e)};this._setOptions=function(e){if(e){this.options=b.extend(true,{},this.options,e)}};this._createRootNode=function(e){this.$root=b(e)};this._initRootNode=function(){this.$root.attr("id",this.getWidgetId());this.$root.addClass(this._getWidgetPackage());this.$root.addClass(this.getWidgetClass())};this._getWidgetPackage=function(){return"j_widget"};this._loadGlobalCSS=function(){$j.session.ready(function(){var e=$j.session.host.getPeacockRoot()+"jenga/widget/global.css?v="+$j.session.host.peacockRevision;$j.loader({css:[e]})})};this.getWidgetAssetURL=function(i){var f=$j.session.host.getPeacockRoot();var h=this.getAssetClass().replace(/\_/g,"/").replace("j/","jenga/widget/");var g=i?"."+i:"";var e="?v="+$j.session.host.peacockRevision;if($j.session.host.isDev()){e+="&rand="+Math.random()}return f+h+g+e};this.buildEventKey=function(f,e){var g=f+"."+this.getWidgetClass();if(e===true){g+="."+this.getInstanceId()}return g};this._construct(d,c)}})(jQuery);(function(a){$j.widget=function(c,b,d){$j.plugin(c,function(e){if(a.isFunction(b)){$j.JengaWidget.call(this,e,c);b.call(this)}else{a.error("Jenga WidgetPlugin does not have a valid method to call")}},d)}})(jQuery);(function(a){$j.ToggleMixin=function(){this.getMixinClass=function(){return"ToggleMixin"};this._rootIsHidden=true;this.isHidden=function(){return this._rootIsHidden};this.checkInit=function(b){if(this._isInitialized===false){this.init(b)}};this.publicFunction=function(b,c){this[b]=function(d){this.checkInit(d);c.apply(this,arguments);return this}};this.publicFunction("toggle",function(b){if(this.isHidden()===true){this.show(b)}else{this.hide(b)}});this.publicFunction("show",function(b){this._rootIsHidden=false;this.$root.show()});this.publicFunction("hide",function(b){this._rootIsHidden=true;this.$root.hide()})}})(jQuery);(function(c){var b=[];var a=false;$j.namespace("$j.mtmpl");$j.MustacheMixin=function(){var d=null;this.init=function(e){var f={loadCss:true,templateClass:this.getWidgetClass()};d=c.extend({},f,e);if(c.inArray(this.getWidgetClass(),b)>-1){return}b.push(this.getWidgetClass());if(this.options.lazyLoadMustacheAssets===false){this._loadTemplate()}else{this._loadAssets(this._loadTemplate)}};this.refresh=function(){var e=this;if(!this._isInitialized){$j.log("widget not initialized"+e.getWidgetClass());return}$j.session.ready(function(){try{e._onTemplatesReady(function(){var g=e.templates();if(g){e._render(g);e._isRendered=true}else{$j.log("templates not available for "+e.getWidgetClass())}})}catch(f){$j.log(f);$j.log(e._pluginName)}})};this._render=function(e){};this._onTemplatesReady=function(e){if(this.templates()){e()}else{$j.bind("$j.MustacheMixin.templatesReady."+d.templateClass,e)}};this._loadAssets=function(f){var e=this;$j.session.hostReady(function(){if(!a){a=true;if(typeof c.fn.mustache=="undefined"){$j.loader({js:[$j.session.host.getPeacockRoot()+"jquery/mustache.js"],context:this,success:function(){$j.log("{{mustache}} lazy loaded")}})}}if(d.loadCss){$j.loader({css:[this.getWidgetAssetURL("css")],context:this,success:function(){if(typeof f==="function"){if($j.session.host.isDev()){$j.log(e.getWidgetClass()+" assets loaded")}f.call(e)}},complete:function(){}})}else{f.call(e)}},this)};this.templates=function(f){try{if(f!==undefined){$j.mtmpl[this.getWidgetClass()]=f;if(d.templateClass!=this.getWidgetClass()){$j.mtmpl[d.templateClass]=f}}return $j.mtmpl[d.templateClass]}catch(e){$j.log("template error in: "+this.getWidgetClass());return""}};this.getTemplate=function(e){var f=this.templates();if(typeof f[e]=="undefined"){$j.log(e+" not found in "+d.templateClass);return""}return f[e]};this._loadTemplate=function(){if(this.templates()){return}var f=this._getTemplatesFromNode(this.$root);if(f){this.templates(f);$j.trigger("$j.MustacheMixin.templatesReady."+d.templateClass)}else{var e=this;$j.session.hostReady(function(){var g=e.getWidgetAssetURL(e.$root.data("skin")?e.$root.data("skin")+".html":"html");g=g.replace("cdn.lib.newsvine.com","lib.newsvine.com");$j.jsonpload(g,e,function(h){if(h.status!=="success"){$j.log.warn("Could not load a template for this template widget. resp=",h.status);return}$node=c("<div>").append(h.data);var i=e._getTemplatesFromNode($node);if(i){e.templates(i);$j.trigger("$j.MustacheMixin.templatesReady."+d.templateClass)}},{cache:($j.session.host.isDev()===false)})},this)}};this.getAssetClass=function(){return d.templateClass};this._getTemplatesFromNode=function(g){var k=false;try{var f=g.find('script[class^="template_"]');if(f.size()>0){var k={};for(var j=0;j<f.size();j++){$tmpl=c(f[j]);var h=$tmpl.attr("class").replace("template_","");k[h]=$tmpl.html().trim()}}return k}catch(l){$j.log.warn("Could not load a template for "+_self.getWidgetClass()+". error=",l);return k}};this.render_template=function(g,h,e){h=h||{};h.options=c.extend(true,{},this.options,h.options);var f=c(c.mustache(g,h));if(e&&e.size()>0){e.html(f)}return f};this.append_template=function(f,g,e){var h=this.render_template(f,g);e.append(h);return h};this.render_template_partials=function(g,h,f){h=h||{};h.options=c.extend(true,{},this.options,h.options);var e=c(c.mustache(g,h,f));return e}}})(jQuery);(function(a){$j.ModalMixin=function(){this.modal=function(b,d){var c=this;var d=a.extend(true,{show:true,title:"&nbsp;",title_tag:"h1",cancel_label:"Cancel",save_label:"Save changes",scope:this,close:function(f){this.hide()},cancel:function(f){this.hide()},save:function(f){this.hide()},body:function(g,f){},header:function(f,g){if(typeof d.close==="function"){a('<a href="#" class="c-modal-close">&times;</a>').click(g,function(h){h.preventDefault();d.close.call(h.data,h)}).appendTo(f)}if(d.title!==""){a("<"+d.title_tag+"/>").addClass("c-modal-title").html(d.title).appendTo(f)}},footer:function(f,g){if(typeof d.save==="function"){a('<button class="c-button b-save"/>').text(d.save_label).click(g,function(h){h.preventDefault();d.save.call(h.data,h)}).appendTo(f)}if(typeof d.cancel==="function"){a('<button class="c-button b-cancel"/>').text(d.cancel_label).click(g,function(h){h.preventDefault();d.cancel.call(h.data,h)}).appendTo(f)}}},d);var e=new function(){this.$modal=b;this.options=d;this.hide=function(){this.$modal.j_modal("hide",this.options)};this.show=function(){this.$modal.j_modal("show",this.options)};this.toggle=function(){this.$modal.j_modal("toggle",this.options)};if(typeof d.header==="function"&&(d.title!==""||d.close!==false)){this.$header=a('<div class="c-modal-header" />').appendTo(this.$modal);d.header.call(d.scope,this.$header,this)}if(typeof d.body==="function"){this.$body=a('<div class="c-modal-body" />').appendTo(this.$modal);d.body.call(d.scope,this.$body,this)}if(typeof d.footer==="function"&&(d.cancel!==false||d.save!==false)){this.$footer=a('<div class="c-modal-footer" />').appendTo(this.$modal);d.footer.call(d.scope,this.$footer,this)}if(this.options.show===true){this.$modal.j_modal("show",this.options)}else{this.$modal.hide()}this.reset=function(f){e.hide();b.empty();c._isRendered=false;c._render();c._isRendered=true;if(f===true){e.hide()}}};return e}}})(jQuery);(function(a){$j.namespace("$j.widget");$j.widget.AbstractWidget=Class.extend(new function(){this.instanceId=null;this.options={};this._construct=function(b){this.instanceId=$j.util.uid();this.$root=a('<div class="j_widget '+this.getClassName()+'"/>').appendTo(a(b));this.$root.attr("id",this.getWidgetNodeId())};this.destroy=function(){a(window).unbind(this.buildEventKey(""));this.$root.removeData(this.buildDataKey());this.$root.removeData(this.getClassName());this.$root.remove()};this.init=function(b){b=b||{};this.init_options(b);this.init_root_node(this.options);this.init_render()};this.init_options=function(b){if(b){this.options=a.extend(true,{},this.options,b)}};this.init_root_node=function(c){var b=c;$j.session.ready(function(){if(b.edition){this.$root.addClass("j_edition_"+b.edition)}var d=b.affiliate?"j_affiliate_"+b.affiliate:this.getWidgetAffiliate();this.$root.addClass(d)},this)};this.init_render=function(){assets=this.options.assets||{css:true};this.load(assets,function(){this.render(this.$root,this.options.nodes)})};this.getWidgetNodeId=function(){return this.getClassName()+"_"+this.getInstanceId()};this.getInstanceId=function(){return this.instanceId};this.getClassName=function(b){b=b||"_";return this.getPluginClass().toLowerCase().replace("$j","j").replace(/\./g,b)};this.getWidgetName=function(){return this.getClassName().substr(this.getClassName().lastIndexOf("_")+1)};this.getWidgetAffiliate=function(){var b=$j.session.host.getDomainRoot();if(b==="newsvine.com"){return"j_affiliate_newsvine"}else{if(b==="today.com"||b==="today.msnbc.msn.com"){return"j_affiliate_today"}else{if(b==="msnbc.msn.com"){return"j_affiliate_msnbc"}}}};this.adjustParent=function(c){if(c.closest("."+this.getClassName()).size()===0){var b=this.$root.get(0).className;c=a('<div class="'+b+'" />').appendTo(c)}return c};this.moveRoot=function(b){if(b==="parent"){}else{if(b==="append"){}else{if(b==="first_child"){if(this.$root.parent().children().size()>1){this.$root.parent().children(":first").before(this.$root)}}}}};this.getData=function(){var b=this.$root.data(this.buildDataKey());return b?b:{}};this.setData=function(b){this.$root.data(this.buildDataKey(),b)};this.get=function(c,b){var d=this.getData();if(typeof d[c]==="undefined"){return b}else{return d[c]}};this.set=function(b,d){var c=this.getData();c[b]=d;this.setData(c)};this.buildDataKey=function(){return this.getClassName()+"_data"};this.buildEventKey=function(b){return b+"."+this.getClassName()+"."+this.getInstanceId()};this.bind=function(c,d){var b=this;this.$root.bind(this.buildEventKey(c),function(){d.apply(b,arguments)})};this.trigger=function(b,c){this.$root.trigger(this.buildEventKey(b),c)};this.render=function(c,b){c=c||this.$root;b=b||this.options.nodes;this.before_render(c,b);this.build_nodes(c,b);this.render_nodes(b);this.after_render(c,b)};this.reload=function(c,b){c=c||this.$root;b=b||this.options.nodes;c.empty();this.render(c,b)};this.before_render=function(c,b){};this.after_render=function(c,b){};this.build_nodes=function(d,c){for(var b in c){this.build_node(d,b,c[b])}};this.build_node=function(e,b,d){if(!d){return}var c=d.nodeType||"div";d.$root=a("<"+c+"/>").appendTo(e);d.$root.addClass(b)};this.render_nodes=function(c){for(var b in c){this.render_node(b,c[b])}};this.render_node=function(b,c){this.custom_render("before",b,c);if(c.nodes){this.build_nodes(c.$root,c.nodes);this.render_nodes(c.nodes)}c.$root.html(c.html);this.custom_render("",b,c);this.load_plugins(c.$root,c.plugins);this.custom_render("after",b,c)};this.custom_render=function(c,b,e){var c=c?"_"+c:"";var d=this["render_"+b+c];if(d&&typeof d==="function"){d.call(this,e)}};this.load_plugins=function(c,b){if(b&&b.length>0){for(var d=0;d<b.length;d++){this.load_plugin(c,b[d])}}};this.load_plugin=function(b,c){if(!c.plugin){return}if(typeof c.plugin==="string"){c.plugin=a.fn[c.plugin]}c.method=c.method||"init";c.options=c.options||{};c.plugin.call(b,c.method,c.options)};this.getTemplatePath=function(b){var e=this.getAssetPath().replace("cdn.lib.newsvine.com","lib.newsvine.com");var d=e+b;if($j.session.uri.protocol==="https"){var c=$j.session.host.getNewsvineRoot(true)+"_api/util/jsonpload?v="+$j.session.host.peacockRevision+"&u="+d}else{var c=$j.session.host.getCDNRoot()+"/_api/util/jsonpload?v="+$j.session.host.peacockRevision+"&u="+d}return c};this.getAssetPath=function(){var b=$j.session.host.getPeacockRoot();var c=b+"jenga/widget/"+this.getWidgetName()+"/";return c};this.load=function(c,e){if(a.isFunction(c)){e=c;c={}}var c=a.extend(true,{css:false,js:false,template:false},c);var d=c;var b=e;$j.session.ready(function(){this._init_load(d,b)},this)};this.get_global_css=function(){return this.getAssetPath()+"../global.css?v="+$j.session.host.peacockRevision};this._init_load=function(b,d){if(b.css===true){b.css=[this.getAssetPath()+this.getWidgetName()+".css?v="+$j.session.host.peacockRevision,this.get_global_css()]}if(b.template===true){if(b.js===false){b.js=["//ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js"]}if(b.mustache){b.js.push($j.session.host.getPeacockRoot()+"jquery/mustache.js")}var c=d;d=function(){$j.jsonp(this.getTemplatePath(this.getWidgetName()+".html"),this,function(f){if(f.status==="success"){var e=a(f.data)}else{var e=false}if(a.isFunction(c)===true){c.call(this,e)}})}}if(b.css||b.js){b.context=this;b.success=function(){d.call(this)};b.js=b.js===false?[]:b.js;b.css=b.css===false?[]:b.css;$j.loader(b)}else{if(a.isFunction(d)===true){d.call(this)}}};this.lightbox=function(b,d,c){var c=a.extend(true,{plugins:[{plugin:b,options:d}]},c);this.$root.parent().lightbox(c);this.destroy()};this.lightbox_button=function(b,e,c,d){var c=a.extend(true,{plugins:[{plugin:b,options:e}]},c);var d=a.extend(true,{label:"Log in"},d);$button=a("<button/>").appendTo(this.$root.parent());$button.text(d.label);$button.click(this,function(f){a(f.target).lightbox("show")});$button.lightbox(c);this.destroy()}});$j.widget.AbstractWidget.prototype.getPluginClass=function(){if(this.className){return this.className}else{throw ("Class Name not defined")}}})(jQuery);(function(c){var b=[];var a=function(d){return"__"+d+"__self__"};$j.plugin=function(f,d,e){var g={autoload:false};if(typeof f!=="string"){c.error("Jenga pluginName must be defined")}if(typeof d!=="function"){c.error("Jenga pluginFunction must be defined")}if(typeof e==="object"){g=c.extend({},g,e)}b.push(f);c.fn[f]=function(){var i=arguments.length>=0?arguments[0]:null;if(!i||typeof i==="object"){i="init";var h=arguments;h[0]=h.length>0?h[0]:{}}else{var h=Array.prototype.slice.call(arguments,1)}return this.each(function(m,n){var p=c(n).pluginObj(f);if(typeof p!=="object"){p=new d(n,h[0]);p._pluginName=f;c(n).data(a(f),p)}if(i==="init"){var j=c(this);var o=j.data();var k=h[0];for(var l in o){if(l.startsWith("__")===false){k[l]=o[l]}}h[0]=k}if(typeof p[i]==="function"){p[i].apply(p,h)}else{if(i==="init"){}else{c.error("JengaPlugin does not have a valid method to call ["+i+"]")}}})};if(g.autoload===true){$j.plugin.autoload("."+f,f)}};$j.plugin.autoload=function(d,e){c(document).ready(function(){if(typeof c.fn[e]==="function"){c(d).each(function(f,g){c(g)[e]({})})}})};c.fn.pluginObj=function(d){return c(this).data(a(d))};c.fn.jenga_loadPlugins=function(){var d=function(f,g){if(c(g).attr("class")){var e=c(g).attr("class").split(" ");if(e.length>0){for(var j=0;j<e.length;j++){var h=e[j];if(c.inArray(h,b)>-1&&typeof c(g).pluginObj(h)!=="object"){$j.plugin.autoload(c(g),h)}}}}};c(this).contents().andSelf().each(d);return this};c.fn.loadPlugins=c.fn.jenga_loadPlugins})(jQuery);(function(e){$j.namespace("$j.loader");var b=[];var d="http://i.newsvine.com";$j.loader=function(g,f){if(typeof g=="object"){f=g;g="init"}new a()[g](f)};$j.loader.defaults={js:[],css:[],img:[],name:null,cdn:false,timeout:20000,success:function(){},error:function(){},complete:function(){},each:function(){},context:this};var c=document.getElementsByTagName("head")[0];function a(){var o=this,q,k=[],m=[],l,f,h,g=[];this.init=function(r){if(!r){return}q=e.extend({},$j.loader.defaults,r);h={js:q.js,css:q.css,img:q.img};e.each(h,function(s,t){if(typeof t=="string"){t=t.split(",")}g=g.concat(t)});if(!g.length){j("error");return}if(q.timeout){l=setTimeout(function(){var s=k.concat(m);e.each(g,function(u,t){e.inArray(t,s)==-1&&m.push(t)});j("error")},q.timeout)}e.each(h,function(t,u){var s=q.cdn&&!vine.session.devMachine;if(e.isArray(u)){e.each(u,function(w,v){if(s&&v.substring(0,4)!="http"){v=vine.util.appendParamToURL(d+v,"r",vine.session.revision)}n(t,v)})}else{if(typeof u=="string"){if(s&&u.substring(0,4)!="http"){u=vine.util.appendParamToURL(d+u,"r",vine.session.revision)}n(t,u)}}})};this.js=function(w,x,t){var v=e('script[src*="'+w+'"]');if(v.length){v.attr("pending")?v.bind("scriptload",x):x();return}var u=document.createElement("script");u.setAttribute("type","text/javascript");u.setAttribute("src",w);u.setAttribute("id",t);u.setAttribute("pending",1);u.onerror=p;e(u).bind("scriptload",function(){e(this).removeAttr("pending");x();setTimeout(function(){e(u).unbind("scriptload")},10)});var r=false;u.onload=u.onreadystatechange=function(){if(!r&&(!this.readyState||/loaded|complete/.test(this.readyState))){r=true;u.onload=u.onreadystatechange=null;e(u).trigger("scriptload")}};c.appendChild(u)};this.css=function(s,w,t){if(e('link[href*="'+s+'"]').length){w();return}if(typeof s!=="string"){return}if(s.indexOf("//")===0){s=location.protocol+s}var u=e('<link rel="stylesheet" type="text/css" media="all" href="'+s+'" id="'+t+'"></link>')[0];if(e.browser.msie){u.onreadystatechange=function(){/loaded|complete/.test(u.readyState)&&w()}}else{if(e.browser.opera){u.onload=w}else{if(s.indexOf("//")===0){s="http:"+s}var r=location.hostname.replace("www.",""),v=/http:/.test(s)?/^(\w+:)?\/\/([^\/?#]+)/.exec(s)[2]:r;s.indexOf("https://")===0||(r!=v&&e.browser.mozilla)?w():(function(){try{u.sheet.cssRules}catch(x){f=setTimeout(arguments.callee,20);return}w()})()}}c.appendChild(u)};this.img=function(s,t){var r=document.createElement("img");r.onload=t;r.onerror=p;r.src=s;b.push(r)};this.disable=function(r){e("#lazy-loaded-"+r,c).attr("disabled","disabled")};this.enable=function(r){e("#lazy-loaded-"+r,c).removeAttr("disabled")};this.destroy=function(r){e("#lazy-loaded-"+r,c).remove()};function n(s,r){o[s](r,function(t){t=="error"?m.push(r):k.push(r)&&q.each(r);i()},"lazy-loaded-"+(q.name?q.name:new Date().getTime()))}function j(r){q.complete.call(q.context,r,k,m);q[r].call(q.context,(r=="error"?m:k));clearTimeout(l);clearTimeout(f)}function i(){if(k.length==g.length){j("success")}else{if(k.length+m.length==g.length){j("error")}}}function p(){m.push(this.src);i()}}})(jQuery);(function(a){$j.namespace("$j.PluginWrapper");$j.PluginWrapper.handler=function(e,b,c){var f=c.length>=0?c[0]:null;if(!f||typeof f==="object"){f="init"}else{c=Array.prototype.slice.call(c,1)}var d=e.prototype.getPluginClass();if(f==="getObject"){return a(b.get(0)).data(d)}else{if(f==="getSelf"){return a(b.get(0)).parent().data(d)}}return b.each(function(){var g=a(this).data(d);if(!g){var g=new e(this);a(this).data(d,g)}else{if(g&&f==="init"){return}}if(a.isFunction(g[f])){g[f].apply(g,c)}else{a.error("Method "+f+" is not a function defined by this Plugin.")}})}})(jQuery);(function(a){$j.cookie=function(e,f,c){if(arguments.length>1&&String(f)!=="[object Object]"){c=a.extend({},c);if(f===null||f===undefined){c.expires=-1}if(typeof c.expires==="number"){var h=c.expires,d=c.expires=new Date();d.setDate(d.getDate()+h)}f=String(f);return(document.cookie=[encodeURIComponent(e),"=",c.raw?f:encodeURIComponent(f),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join(""))}c=f||{};var b,g=c.raw?function(i){return i}:decodeURIComponent;return(b=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie))?g(b[1]):null};if(typeof a.cookie==="undefined"){a.cookie=$j.cookie}})(jQuery);(function(b){$j.date=function(d,c){if(typeof d==="object"){c=d}var c=b.extend({},c);return new function(){this.options=c;this.date=new Date();if(d){this.date.setTime(d)}this.format=function(e){return a(e,this.date.getTime())}}};$j.date.returnMonth=function(d){var c=["January","February","March","April","May","June","July","August","September","October","November","December"];return c[d-1]};$j.date.format=function(d,c){return $j.date(c).format(d)};$j.date.localLongFormat=function(d){var c=(new Date(d));var e=c.toLocaleTimeString();return c.toLocaleDateString()+" "+e};function a(l,j){var i=this,k,h,d=/\\?([a-z])/gi,c,e=function(m,f){if((m=m+"").length<f){return new Array((++f)-m.length).join("0")+m}return m},g=["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur","January","February","March","April","May","June","July","August","September","October","November","December"];c=function(f,m){return h[f]?h[f]():m};h={d:function(){return e(h.j(),2)},D:function(){return h.l().slice(0,3)},j:function(){return k.getDate()},l:function(){return g[h.w()]+"day"},N:function(){return h.w()||7},S:function(){var f=h.j();return f>4&&f<21?"th":{1:"st",2:"nd",3:"rd"}[f%10]||"th"},w:function(){return k.getDay()},z:function(){var m=new Date(h.Y(),h.n()-1,h.j()),f=new Date(h.Y(),0,1);return Math.round((m-f)/86400000)+1},W:function(){var m=new Date(h.Y(),h.n()-1,h.j()-h.N()+3),f=new Date(m.getFullYear(),0,4);return e(1+Math.round((m-f)/86400000/7),2)},F:function(){return g[6+h.n()]},m:function(){return e(h.n(),2)},M:function(){return h.F().slice(0,3)},n:function(){return k.getMonth()+1},t:function(){return(new Date(h.Y(),h.n(),0)).getDate()},L:function(){return new Date(h.Y(),1,29).getMonth()===1|0},o:function(){var o=h.n(),f=h.W(),m=h.Y();return m+(o===12&&f<9?-1:o===1&&f>9)},Y:function(){return k.getFullYear()},y:function(){return(h.Y()+"").slice(-2)},a:function(){return k.getHours()>11?"pm":"am"},A:function(){return h.a().toUpperCase()},B:function(){var m=k.getUTCHours()*3600,f=k.getUTCMinutes()*60,n=k.getUTCSeconds();return e(Math.floor((m+f+n+3600)/86.4)%1000,3)},g:function(){return h.G()%12||12},G:function(){return k.getHours()},h:function(){return e(h.g(),2)},H:function(){return e(h.G(),2)},i:function(){return e(k.getMinutes(),2)},s:function(){return e(k.getSeconds(),2)},u:function(){return e(k.getMilliseconds()*1000,6)},e:function(){throw"Not supported (see source code of date() for timezone on how to add support)"},I:function(){var m=new Date(h.Y(),0),o=Date.UTC(h.Y(),0),f=new Date(h.Y(),6),n=Date.UTC(h.Y(),6);return 0+((m-o)!==(f-n))},O:function(){var m=k.getTimezoneOffset(),f=Math.abs(m);return(m>0?"-":"+")+e(Math.floor(f/60)*100+f%60,4)},P:function(){var f=h.O();return(f.substr(0,3)+":"+f.substr(3,2))},T:function(){return"UTC"},Z:function(){return -k.getTimezoneOffset()*60},c:function(){return"Y-m-d\\Th:i:sP".replace(d,c)},r:function(){return"D, d M Y H:i:s O".replace(d,c)},U:function(){return k.getTime()/1000|0}};this.date=function(m,f){if(m==undefined){return}i=this;k=((typeof f==="undefined")?new Date():(f instanceof Date)?new Date(f):new Date(f*1000));return m.replace(d,c)};return this.date(l,j)}})(jQuery);(function(a){$j.namespace("$j.util");String.prototype.trim=function(){return(this.replace(/^\s*|\s*$/g,""))};String.prototype.startsWith=function(b){return(this.substr(0,b.length)==b)};String.prototype.endsWith=function(b){return(this.substr(this.length-b.length)==b)};String.prototype.urlencode=function(){return encodeURIComponent(this)};String.prototype.urldecode=function(){return decodeURIComponent(this)};String.prototype.striptags=function(){return this.replace(/<\/?[^>]+>/gi,"")};String.prototype.truncate=function(b,d){if(!b){b=300}if(this.length>b){var e=this.substring(0,b);if(e){var f=e.split(" ");var c=f.splice(0,f.length-2).join(" ");return c+(d!==undefined?d:"...")}}return this};$j.util.uid=function(){var b=a(document.body).data("jenga_util_uid");if(typeof b==="undefined"){b=0}a(document.body).data("jenga_util_uid",++b);return b};$j.util.validate_email=function(b){if(b&&b.trim()&&b.match(/\w{1,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/)){return true}else{return false}};$j.util.validate_domain=function(b,c){var d=60;var c=typeof c==="undefined"?4:c;if(typeof b!=="string"){return false}b=b.trim();if(b.length>=c&&b.length<=d&&!b.match(/[^a-z0-9\-]/)){return true}else{return false}};$j.util.validate_display=function(c){var d=60;var b=4;if(typeof c!=="string"){return false}c=c.trim();if(c.length>=b&&c.length<=d){return true}else{return false}};$j.util.validate_password=function(b){if(b&&b.trim()&&b.trim().length>3){return true}else{return false}};$j.util.formData=function(b){var c={jsoncallback:1};jQuery.map(a(b).serializeArray(),function(e,d){c[e.name]=e.value});return c};$j.util.dumpObjectToHTML=function(g,b){var d="";var f={};var b=typeof b==="undefined"?true:b;if(g!==null&&typeof g==="object"){d+="<table>";for(var c in g){var e=g[c];if(e===null||typeof e==="string"||typeof e==="number"||typeof e==="boolean"){}else{if(typeof e==="object"){if(b===true){f[c]=$j.util.dumpObjectToHTML(e);c=false}else{e="object"}}else{c=false}}if(c!==false){d+="<tr><td><label>"+c+"</label></td><td>"+e+"</td></tr>"}}if(b===true){for(var c in f){d+="<tr><td><label>"+c+"</label></td><td>"+f[c]+"</td></tr>"}}d+="</table>"}return d};$j.util.toSimpleObject=function(g,b){var h={};var b=typeof b==="undefined"?true:b;if(g===null||typeof g==="undefined"){return null}else{if(typeof g==="function"){return"function"}else{if(typeof g!=="object"){return g}else{if(typeof g.jquery!=="undefined"||typeof g.nodeName!=="undefined"){return"object"}}}}for(var d in g){var f=g[d];if(typeof f==="string"||typeof f==="number"||typeof f==="boolean"){h[d]=f}else{if(typeof f==="object"&&b===true){var e=$j.util.toSimpleObject(f);if(e!=="object"){h[d]=e}}else{if(typeof f==="function"&&b===true){if(f.length===0&&(d.startsWith("is")||d.startsWith("has")||d.startsWith("get"))){var c=f.call(g);var e=$j.util.toSimpleObject(c);if(e!=="object"){h[d]=e}}}else{}}}}return h};a.fn.serializeObject=function(){var b,c;b=this.serializeArray();c={};a.each(b,function(){var d;if(this.value!=null){d=this.value}else{d=""}if(c[this.name]!=null){if(!c[this.name].push){c[this.name]=[c[this.name]]}c[this.name].push(d)}else{c[this.name]=d}});return c};$j.util.isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return($j.util.isMobile.Android()||$j.util.isMobile.BlackBerry()||$j.util.isMobile.iOS()||$j.util.isMobile.Opera()||$j.util.isMobile.Windows())}}})(jQuery);(function(a){$j.namespace("$j.log");$j.log=function(){$j.log.console("info",arguments)};$j.log.console=function(e,b){if(typeof console==="undefined"){return}else{if(a.isFunction(console[e])===true){console[e].apply(console,b)}else{if(typeof console[e]!=="undefined"){var d=[];for(var c=0;c<b.length;c++){d[c]=b[c]}console[e](d)}}}};$j.log.warn=function(){$j.log.console("warn",arguments)};$j.log.error=function(){$j.log.console("error",arguments)};$j.log.assert=function(){$j.log.console("assert",arguments)};$j.log.dir=function(){$j.log.console("dir",arguments)}})(jQuery);(function(a){$j.uri=function(b){return new function(){this.uri=null;this.anchor=null;this.anchorParams=new Array();this.domain=null;this.host=null;this.nodes=new Array();this.params=new Array();this.password=null;this.path=null;this.port=null;this.protocol=null;this.queryString=null;this.subDomain=this.username=null;if(b){this.uri=b;var e=/^((\w+):\/\/)?((\w+):?(\w+)?@)?([^\/\?:]+):?(\d+)?(\/?[^\?#]+)?\??([^#]+)?#?([\w=&]*)/;var c=e.exec(b);this.protocol=c[2];this.username=c[4];this.password=c[5];this.host=c[6];this.port=c[7];this.path=c[8];this.queryString=c[9];this.anchor=c[10];this.nodes=this.host.split(".");if(this.nodes.length<=2){this.domain=this.host;this.subDomain=""}else{this.domain=this.nodes.slice(-2).join(".");if(this.nodes.length==3){this.subDomain=this.nodes[0]}else{this.subDomain=this.nodes.slice(0,this.nodes.length-3)}}if(this.queryString){var g=this.queryString.split("&");for(var d=0;d<g.length;d++){var f=g[d].split("=");if(f.length==1){this.params[f[0]]=null}else{this.params[f[0]]=f[1]}}}if(this.anchor){var g=this.anchor.split("&");for(var d=0;d<g.length;d++){var f=g[d].split("=");if(f.length==1){this.anchorParams[f[0]]=null}else{this.anchorParams[f[0]]=f[1]}}}}this.isset=function(h){if(typeof(this.params[h])==="undefined"){return false}else{return true}};this.getParam=function(i,h){if(this.params[i]&&typeof this.params[i]!=="function"){if(typeof this.params[i]==="string"){return this.params[i].urldecode()}else{return this.params[i]}}else{return h?h:null}};this.setParam=function(h,i){h=typeof h==="string"?h.urlencode():h;i=typeof i==="string"?i.urlencode():i;this.params[h]=i;return this};this.clearParam=function(h){if(this.isset(h)){delete this.params[h]}return this};this.issetAnchor=function(h){if(typeof(this.anchorParams[h])==="undefined"){return false}else{return true}};this.getAnchor=function(i,h){if(typeof this.anchorParams[i]==="string"){return this.anchorParams[i]}else{return h?h:null}};this.setAnchor=function(i,j,h){i=typeof i==="string"?i.urlencode():i;j=typeof j==="string"?j.urlencode():j;this.anchorParams[i]=j;if(!h){this.assemble();location.href=this.assemble()}return this};this.clearAnchors=function(){this.anchor="";this.anchorParams=new Array();return this};this.make=function(j){var i=$j.uri(this.uri);if(typeof j==="object"){for(var h in j){i[h]=j[h]}}return i};this.assemble=function(){var l=this.protocol+"://"+(this.username?this.username+(this.password?":"+this.password:"")+"@":"")+this.host+(this.port?":"+this.port:"")+this.path;var h="";var k=false;for(var j in this.params){if(typeof this.params[j]=="function"){continue}if(this.params[j]==undefined){continue}h+=(k?"&":"?")+j;h+=this.params[j]?"="+this.params[j]:"";k=true}if(typeof(this.params.sort)==="string"){h+=(k?"&":"?")+"sort";h+=this.params.sort?"="+this.params.sort:""}if(k){l+=h}var i="";var k=false;for(var j in this.anchorParams){if(typeof this.anchorParams[j]=="function"){continue}if(this.anchorParams[j]==undefined){continue}i+=(k?"&":"#")+j;i+=this.getAnchor(j)?"="+this.getAnchor(j):"";k=true}if(k){l+=i}return l}}}})(jQuery);(function(a){$j.bind=function(b,d,c){b=b.replace(/\./g,"_").replace("$j","jenga");a(window).bind(b,function(f,e){d.call(c,e,f)})};$j.trigger=function(b,c){b=b.replace(/\./g,"_").replace("$j","jenga");a(window).trigger(b,c)};$j.unbind=function(b){b=b.replace(/\./g,"_").replace("$j","jenga");a(window).unbind(b)};$j.debounce=function(e,b,c){var f;return function d(){var i=this,h=arguments;function g(){if(!c){e.apply(i,h)}f=null}if(f){clearTimeout(f)}else{if(c){e.apply(i,h)}}f=setTimeout(g,b||100)}};$j.script=function(c,d,e,b){if(typeof d==="function"){b=e;e=d;d=null}if(typeof b!=="object"){b={}}if(typeof b.cache==="undefined"){b.cache=true}b.url=b.url?b.url:c;b.dataType="script";b.success=b.success?b.success:function(){if(e){e.apply(d,arguments)}};a.ajax(b)};$j.jsonp=function(c,d,e,b){if(typeof d==="function"){b=e;e=d;d=null}if(typeof b!=="object"){b={}}if(typeof b.cache==="undefined"){b.cache=true}if(b.cache===true){b.jsonpCallback=jenga_callbacks.registerCallback(d,c,e)}b.url=b.url?b.url:c;b.dataType="jsonp";b.crossDomain=true;b.success=b.success?b.success:function(){if(e){e.apply(d,arguments)}};b.callbackParameter="callback";a.jsonp(b)};$j.jsonpload=function(c,d,e,b){if($j.session.uri.protocol==="https"){var c=$j.session.host.getNewsvineRoot(true)+"_api/util/jsonpload?u="+c}else{var c=$j.session.host.getCDNRoot()+"/_api/util/jsonpload?u="+c}$j.jsonp(c,d,e,b)}})(jQuery);var jenga_callbacks={registerCallback:function(b,a,d){var c="id"+a.replace("https://","").replace("http://","").replace(/[^a-zA-Z0-9]+/g,"");jenga_callbacks[c]=function(){d.apply(b,arguments)};return"jenga_callbacks."+c}};(function(a){$j.namespace("$j.avatar");$j.avatar={getSizedAvatarURL:function(c,b){if(c.indexOf("/group.gif")>0){return c}if(!b){b=90}return c.replace(/\/\d+x\d+/,"/"+b+"x"+b).replace(/width=\d+/,"width="+b)},getDefaultAvatar:function(d){if(d!==30&&d!==60&&d!==120){d=90}var c=$j.session.host.getCDNRoot();c+="/_vine/images/av/"+d+"x"+d+"/";var b=$j.session.host.getDomainRoot();if(b==="newsvine.com"){c+="vine.jpg"}else{if(b==="today.com"||b==="today.msnbc.msn.com"){c+="today.jpg"}else{c+="msnbc.jpg"}}return c},getFromDomain:function(c,b){return $j.session.host.getAPIPath(false,false,true)+"user/avatar?author="+c+"&width="+b},isDefaultGroupAvatar:function(b){if(!b){return false}var c=null;if(typeof b=="string"){c=b}else{if(b.length&&b.attr("src")){c=b.attr("src")}}if(c&&(c.indexOf("group.gif")<0)&&(c.indexOf("/null")<0)){return false}return true},isDefaultUserAvatar:function(b){if(!b){return false}var c=null;if(typeof b=="string"){c=b}else{if(b.length&&b.attr("src")){c=b.attr("src")}}if(c&&c.indexOf("/vine.jpg")<0){return false}return true},getVineacitySrc:function(b){return $j.session.host.getMediaRoot()+"/_vine/images/_/vineacity_sm/vine"+b+".gif"},user_avatar:function(b){return{isDefault:$j.avatar.isDefaultUserAvatar(b),src:function(){return function(c,d){if(!b||$j.avatar.isDefaultUserAvatar(b)){b=$j.avatar.getDefaultAvatar(c)}else{b=$j.avatar.getSizedAvatarURL(b,c)}return d(b)}}}},group_avatar:function(b){return{isDefault:$j.avatar.isDefaultGroupAvatar(b),src:function(){return function(c,d){b=$j.avatar.getSizedAvatarURL(b,c);return d(b)}}}}}})(jQuery);(function(b){var a=true;$j.namespace("$j.ext");$j.ext.FacebookClient=new function(){this.config=null;this.isReady=false;this.isInitializing=false;this.resp=null;this.init=function(c){if(a!==true){return}if(this.isInitializing){return}else{this.isInitializing=true}$j.session.ready(function(){this.config=$j.session.host.getFacebookConfig();if(!this.config.appId){return}if(typeof FB!=="undefined"){$j.ext.FacebookClient.check_FB()}else{var d="//connect.facebook.net/en_US/all.js";if(location.protocol==="file:"){d="http:"+d}$j.loader({js:d,success:function(){b(document).ready(function(){document.getElementsByTagName("html")[0].setAttribute("xmlns:fb","http://www.facebook.com/2008/fbml");if(b("div#fb-root").size()===0){b(document.body).append('<div id="fb-root"/>')}$j.ext.FacebookClient.check_FB()})}})}},this)};this.check_FB=function(){if(typeof FB!=="undefined"){$j.ext.FacebookClient.init_FB()}else{setTimeout($j.ext.FacebookClient.check_FB,10)}};this.init_FB=function(){var d="/_fb/channel.html";var c=$j.session.uri.host;if(c==="www.msnbc.msn.com"){d="/id/46419312"}else{if(c==="today.msnbc.msn.com"){d="/id/46419312"}else{if(c==="video.msnbc.msn.com"){d="/channel.html"}else{if(c==="video.today.msnbc.msn.com"){d="/channel.html"}}}}var e=$j.session.uri.make({path:d}).assemble();FB.init({appId:this.config.appId,channelUrl:e,status:true,xfbml:true});FB.getLoginStatus(function(f){$j.ext.FacebookClient.updateResponse(f);$j.ext.FacebookClient.isReady=true;$j.trigger("$j.ext.fb.isReady",$j.ext.FacebookClient.resp)})};this.updateResponse=function(c){$j.ext.FacebookClient.resp=c};this.getPerms=function(){var c=$j.ext.FacebookClient.config.perms;if($j.session.user.isSharing()){c=this.addPublishActions(c)}return c};this.addPublishActions=function(c){if(typeof c==="string"&&c.indexOf("publish_actions")===-1){c+=", publish_actions"}return c};this.addPublishStream=function(c){if(typeof c==="string"&&c.indexOf("publish_stream")===-1){c+=", publish_stream"}return c};this.buildResponsePerms=function(f){var d="";if(typeof f==="object"&&f.data&&f.data.length>0){var e=f.data[0];for(var c in e){if(e[c]==1){d+=c+","}}}return d};this.checkPerms=function(c,g){if(typeof c!=="string"||typeof g!=="string"){return false}var h=c.split(",");var d=g.split(",");$j.log("request_Perms===",c,h);$j.log("responsePerms===",g,d);for(var f=0;f<h.length;f++){for(var e=0;e<d.length;e++){$j.log(h[f].trim().length,h[f].trim(),d[e].trim(),h[f].trim().length===0||h[f].trim()===d[e].trim());if(h[f].trim().length===0||h[f].trim()===d[e].trim()){break}else{if(e===d.length-1){return false}}}}return true}};$j.fb=function(d,c){if($j.ext.FacebookClient.isReady){if(d){d.call(c,$j.ext.FacebookClient.resp)}}else{if(d){$j.bind("$j.ext.fb.isReady",d,c)}$j.ext.FacebookClient.init()}};$j.fb.unshare=function(c,e){var d={connected:{scope:null,callback:function(f){}},not_connected:{scope:null,callback:function(f){}}};b.extend(d,e);$j.fb(function(f){if(f.status==="connected"){FB.api(c,"delete",function(g){d.connected.callback.call(d.connected.scope,g)})}else{d.not_connected.callback.call(d.not_connected.scope,f)}})};$j.fb.share=function(d){var c={connected:{scope:null,callback:function(f){}},not_connected:{scope:null,callback:function(f){}},data:null,path:null,type:null,action:null,url:null};b.extend(c,d);if(c.path===null&&c.type==="video"){c.path="/me/video.watches";c.data={video:c.url};c.action="watches"}else{if(c.path===null&&c.type==="article"){c.path="/me/news.reads";c.data={article:c.url};c.action="reads"}else{if(c.path===null){return false}}}$j.fb(function(f){if(f.status==="connected"){FB.api(c.path,"post",c.data,function(g){c.connected.callback.call(c.connected.scope,g);if(g&&!g.error){FB.api("/me",function(h){e(c.type,c.action,h.id,b.cookie("vid"),c.data.access_token,c.url)})}})}else{c.not_connected.callback.call(c.not_connected.scope,f)}});function e(l,i,q,g,j,k){var n="https://newscircle.msnbc.msn.com/fb/";var o="msnbc";var m=b('meta[property="og:url"]').attr("content");if(window.location.host.indexOf("today")!=-1){o="today"}var p=b.param({FbId:q,NvId:g,Token:j,url:m,app:o});var f=n+i+"/"+l+"?"+p;var h=new Image();h.src=f}};$j.fb.hasPerms=function(c,d,f,e){$j.fb(function(g){$j.log("checking hasPerms; resp.status===",g.status);if(g.status==="connected"){FB.api("/me/permissions",function(i){var h=$j.ext.FacebookClient.buildResponsePerms(i);if($j.ext.FacebookClient.checkPerms(c,h)){if(typeof d==="function"){d.call(e,g)}}else{if(typeof f==="function"){f.call(e,g)}}})}else{if(typeof f==="function"){f.call(e,g)}}})}})(jQuery);(function(a){$j.namespace("$j.ext");if(typeof twttr==="undefined"){twttr=false}$j.ext.TWITTER_CONFIG={"newsvine.com":{appId:"L7EvKunhgfP2ld36anC1g"},"today.com":{},"msn.com":{appId:"SqwqQUUf54JHcI3QPvUVtg"}};$j.ext.TwitterConfig=function(e){if(!e){for(var d in $j.ext.TWITTER_CONFIG){host=$j.session.uri.host;if(d===host.substr(host.length-d.length)){if(!e||d.length>e.length){e=d}}}}var b=$j.ext.TWITTER_CONFIG[e];if(!b){return}for(var c in b){this[c]=b[c]}};$j.ext.TwitterClient=new function(){this.config=null;this.isReady=false;this.isInitializing=false;this.T=null;this.init=function(b){if(this.isInitializing){return}else{this.isInitializing=true}this.config=new $j.ext.TwitterConfig(b);if(!this.config.appId){return}$j.loader({js:"//platform.twitter.com/anywhere.js?v=1&id="+this.config.appId,success:function(){$j.ext.TwitterClient.check_TW()}})};this.check_TW=function(){if(twttr){$j.ext.TwitterClient.init_TW()}else{setTimeout($j.ext.TwitterClient.check_TW,10)}};this.init_TW=function(){var b=$j.session.uri.make({path:"/_tw/channel.html"}).assemble();twttr.anywhere.config({callbackURL:b});twttr.anywhere(function(c){$j.ext.TwitterClient.T=c;$j.ext.TwitterClient.isReady=true;$j.trigger("$j.ext.tw.isReady",$j.ext.TwitterClient.T)})}};$j.tw=function(c,b){if($j.ext.TwitterClient.isReady){if(c){c.call(b,$j.ext.TwitterClient.T)}}else{if(c){$j.bind("$j.ext.tw.isReady",c,b)}$j.ext.TwitterClient.init()}}})(jQuery);(function(a){$j.namespace("$j.session");$j.session.HostConfig=function(){this.isDevMachine=false;this.webRoot=null;this.logoutUrl=null;this.resetPassUrl=null;this.useHTTPS=null;this.mediaDomain=null;this.mediaPath=null;this.peacockPath=null;this.peacockRevision=null;this.domainName=null;this.displayName=null;this.domainRoot=null;this.regDomain=null;this.tinyMCERoot=null;this.jsonServer=null;this.amazonImageServer=null;this.routingNode=null;this.domainRootLabel=null;this.sharingVariable=null;this.tokens=null;this.maxNations=0;this.ignoreStates="cirx";this.groupType=null;this.init=function(){};this.initFromKeyValues=function(c){for(var b in c){this[b]=c[b]}if(typeof this.webRoot==="string"){this.webRoot=this.webRoot.replace("www.polls.newsvine.com","www.newsvine.com").replace("www.cdn.newsvine.com","www.newsvine.com")}this.mediaPath=window.location.protocol+"//"+this.mediaDomain;this.init()};this.isDev=function(){return this.isDevMachine};this.hasRegDomain=function(){return this.regDomain&&(this.regDomain.indexOf(this.domainRoot)>-1)};this.getFacebookConfig=function(){return this.facebookConfig};this.getJsonServer=function(b){if(b){return this.jsonServer}return this.jsonServer.replace("polls.","")};this.getPublishServer=function(c){var b;if(c==="photo_post"){b="photo"}else{if(c==="video_post"){b="video"}else{if(c==="seed_post"){b="seed"}else{b="article"}}}return this.webRoot+"/_tps/_publish/"+b};this.getRoutingNode=function(b){b=typeof b==="undefined"?"":b;if(this.isDev()||typeof HOSTCONFIG_SERVER!=="undefined"){return $j.session.uri.nodes[1]+b}else{return""}};this.getPeacockRoot=function(){return this.peacockPath};this.getMediaRoot=function(){return"http://"+this.mediaDomain};this.getTinyMCERoot=function(){return(this.tinyMCERoot?this.tinyMCERoot:this.regDomain)};this.getCDNRoot=function(){if(this.isDev()){return this.webRoot}else{return this.getMediaRoot()}};this.getDomainRoot=function(){return this.domainRoot};this.getRegAffiliate=function(){switch(this.domainName){case"business":case"politics":case"msnbc":case"health":case"travel":case"world-news":case"technology-science":return"msnbc.msn.com";break;default:return this.getDomainRoot()}};this.getRegDomainRoot=function(b){if(b===false||this.useHTTPS!==true){if(this.domainRoot==="newsvine.com"){return"http://www."+this.domain+"/"}else{return"http://"+this.regDomain.replace("secure","newsvine")+"/"}}else{return"https://"+this.regDomain+"/"}};this.getNewsvineRoot=function(b){var c=this.webRoot+"/";if(b===true&&this.useHTTPS){c=c.replace("http://","https://")}return c};this.getAPIPath=function(c,b,e){if(e===true){var d=this.getCDNRoot()+"/"}else{var d=this.getRegDomainRoot(window.location.protocol==="https:"||c)}if(b===true){d+="_nv/api/"}else{d+="_api/"}return d};this.getAccountSettingsPath=function(){return this.getRegDomainRoot(true)+"_tps/_accounts/global/settings?multiDomainLogin=true"};this.getLogoutUrl=function(c){if(typeof c==="undefined"){c=location.href}if(c!==false){var b=$j.uri(this.logoutUrl);b.setParam("redirect",c);return b.assemble()}else{return this.logoutUrl}};this.getResetPassUrl=function(b,e){var c=$j.uri(this.resetPassUrl);c.setParam("email",b);if(e){var d=$j.uri(e);d.protocol=c.protocol;c.setParam("rdRedirect",d.assemble())}return c.assemble()};this.getUserDataUrl=function(b,d){var b=typeof b==="undefined"?false:b;var d=typeof d==="undefined"?true:d;var c=this.getAPIPath(b,false)+"user/getUserData";c+="?domainName="+this.domainName;c+="&contentId="+this.getContentId();c+="&contentType="+a('meta[name="contentType"]').attr("content");if(d!==false&&b===false){c+="&multiDomainLogin=true"}return c};this.getContentId=function(){return a('meta[name="contentId"]').attr("content")};this.getContentIdForRemote=function(k,j,i,e){if(!j&&$j.session.host.getContentId()){k($j.session.host.getContentId());return}var g=a("title").text();var l=window.location.protocol+"//"+window.location.hostname+window.location.pathname;var m=null;var c=$j.uri($j.session.host.getAPIPath(false,false,true)+"remoteConversation");if(j){l=j;if(i){g=i}if(e){m=e}}if(l){l=l.split("#")[0].split("?")[0]}c.setParam("u",l);c.setParam("h",g);if(m){c.setParam("t",e)}var b=true;var f=function(){if(b){$j.log("retry remote conversation lookup");b=false;setTimeout(d,4000)}};var d=function(){$j.jsonp(c.assemble(),this,function(h){if(h.data.contentId){k(h.data.contentId*1,h.data.comments);b=false}else{$j.log(h)}},{pageCache:false,complete:f,error:f})};d()}}})(jQuery);(function(a){$j.namespace("$j.session");$j.session.Poke=function(){this.$img=false;this.pokeURL=false;this.init=function(c){this.pokeURL=c||"http://log.newsvine.com/poke.gif";if(location.protocol==="https:"){this.pokeURL=this.pokeURL.replace("http://","https://")}var b=this;a(document).ready(function(){b.$img=a("img#poke");if(!b.$img.get(0)){b.$img=a('<img id="poke" alt="Tracking Image" width="0" height="0" style="display:none;"/>').appendTo(a(document.body))}$j.trigger("$j.session.Poke.isReady")})};this.doPoke=function(e,h,f){var c=this.pokeURL+"?get="+e+"&x="+h;var g=f&&encodeURIComponent(decodeURIComponent(a.param(f)));if(g!=null){c+="&d="+g}c+="&jenga&rand="+Math.floor(Math.random()*1000000000);if(this.$img===false){var b=this;$j.bind("$j.session.Poke.isReady",function(){b.doPoke.call(b,e,h,f)})}else{this.$img.attr("src",c)}$j.trigger("jenga_poke",[[e,h,f]])}}})(jQuery);(function(a){$j.namespace("$j.session");$j.session.UserAccess=function(){this.data={};this.perms={};this.group_perms={};this.init=function(d,c,b){this.data=d;this.perms=c;this.group_perms=b};this.isEmployee=function(){return this.data.isEmployee};this.isAdmin=function(){return this.data.isAdmin};this.isFBS=function(){return true};this.SCOPE_CONTENT="content";this.SCOPE_GROUP="groups";this.GROUP_PUBLIC_DISCUSSION="_public_";this.canChangeMemberState=function(d,c,b){if(!d){$j.log("canChangeMemberState: access denied, no group provided.");return false}groupType=d.groupTypeId%100;assignerState=$j.session.user.getGroupAss(d.domainName);if(this.data.isAdmin){assignerState="s"}if(!assignerState){assignerState="x"}if(this.group_perms&&this.group_perms[groupType]&&this.group_perms[groupType][assignerState]&&this.group_perms[groupType][assignerState][b?b:""]){if((targets=this.group_perms[groupType][assignerState][b?b:""])!=null){return targets.indexOf(c)!=-1}}if(this.perms.groups&&(d.domainName!==this.GROUP_PUBLIC_DISCUSSION)&&(assignerState=="x")&&(c=="x")&&this.perms.groups[d.domainName]&&this.perms.groups[d.domainName]["canComment"]){return true}return false};this.getPermission=function(d,c,b){if(!this.perms){return false}if(c&&!b){return false}if(this.perms[c]&&this.perms[c][b]&&(this.perms[c][b][d]!==undefined)){return this.perms[c][b][d]}return this._getDefaultPerm(d)};this._getDefaultPerm=function(b){if(!this.perms){return false}if(this.perms.defaults&&this.perms.defaults[b]==1){return true}return false}}})(jQuery);(function(a){$j.namespace("$j.session");$j.session.User=function(){this.loginState=-1;this.email=null;this.domainName=null;this.displayName=null;this.url=null;this.avatar=null;this.secure_avatar=null;this.affiliations=null;this.access=null;this.permissions=null;this.msnbc_sharing_optout=false;this.today_sharing_optout=false;this.sailor=true;this.latestThreads={};this.lastSeen=null;this.memberSince=null;this.numArticles=0;this.numComments=0;this.numSeeds=0;this.vinacity="000000";this.groups=[];this.ignoreList=[];this.geo={zip:null,city:null,country:null};this._last_fb_postId=null;this.$event_node=false;var f=0;var e=1;var d=2;var b="Newsvine";var c="facebook:";this.init=function(){};this.initFromKeyValues=function(g){this.email=g.email||null;this.domainName=g.domainName||null;this.displayName=g.displayName||null;this.avatar=g.avatar||null;this.avatar_secure=g.avatar_secure||null;this.loginState=g.loginState?g.loginState*1:0;this.validated=g.isValidated?g.isValidated*1:0;this.registered=g.isRegistered?g.isRegistered*1:0;this.url=g.url||null;this.affiliations=g.affiliation||"";this.lastPub=g.lastPub||1;this.msnbc_sharing_optout=g.msnbc_sharing_optout===true?true:false;this.today_sharing_optout=g.today_sharing_optout===true?true:false;this.sailor=g.sailor;this.geo.zip=g.zip||null;this.geo.city=g.city||null;this.geo.country=g.country||null;if(g.assumedUser){a("body").addClass("c-assumed")}this.access=new $j.session.UserAccess();if(g.access){this.access.init(g.access,(g.permissions?g.permissions:null),(g.group_permissions?g.group_permissions:null))}this.lastSeen=$j.date.format("M, Y",g.lastSeen);this.memberSince=$j.date.format("M, Y",g.memberSince);if(this.loginState){this.numArticles=g.numArticles;this.numComments=g.numComments;this.numSeeds=g.numSeeds;this.vinacity=g.vinacity;this.groups=g.groups;this.ignoreList=g.ignoreList;this.latestThreads=g.latestThreads}this.init()};this.login=function(h){var g=this.isLoggedIn();this.initFromKeyValues(h);if(g===false&&this.isLoggedIn()===true){this.trigger("login")}else{if($j.session.host.isDev()===true||$j.session.host.getRoutingNode()==="app1"){this.trigger("login")}}};this.onLogin=function(g,h){if(typeof g==="function"){h=g;g=null}this.bind("login",function(){h.call(g,this)},this)};this.onSharingSet=function(g,h){if(typeof g==="function"){h=g;g=null}this.bind("sharing_set",function(){h.call(g,this)},this)};this.getEventNode=function(){if(this.$event_node===false){try{this.$event_node=a('<div class="jenga_session_User_event_node" style="display:none;"/>').appendTo(a(document.body))}catch(g){this.$event_node=a(window)}}return this.$event_node};this.bind=function(g,i,h){this.getEventNode().bind(g,function(){i.apply(h,arguments)})};this.trigger=function(g,h){this.getEventNode().trigger(g,h)};this.isPassiveLogin=function(){if(this.loginState===d){return true}else{return false}};this.isActiveLogin=function(){if(this.loginState===e){return true}else{return false}};this.isValidated=function(){return this.isLoggedIn()&&this.validated};this.isRegistered=function(){return this.isLoggedIn()&&this.validated&&this.registered};this.isLoggedIn=function(){if(this.loginState>f){return true}else{return false}};this.getAffiliations=function(){if(typeof this.affiliations==="string"){return this.affiliations.split(",")}else{return[]}};this.getAffiliation=function(i){var h=this.getAffiliations();for(var g in h){if(h[g]===i||(typeof h[g]==="string"&&h[g].startsWith(i))){return h[g]}}return false};this.hasAffiliation=function(g){return this.getAffiliation(g)===false?false:true};this.hasFacebookAff=function(){return this.hasAffiliation(c)};this.isSharing=function(){var g=$j.session.host.sharingVariable;if(g===null){return false}if(this.isLoggedIn()===false){return $j.cookie("sharing_optout")==="true"?false:true}if(typeof this[g]==="undefined"){return false}else{return !(this[g])}};this.isFacebookSharing=function(){if(this.isSharing()&&this.hasFacebookAff()){return true}else{return false}};this.setSharing=function(j,g){if(typeof g==="undefined"){g=false}var l=$j.session.host.sharingVariable;if(l===null){return false}if(typeof this[l]==="undefined"||typeof $j.session.host.tokens[l]==="undefined"){return false}if(j===false){$j.cookie("sharing_optout",true,{expires:3650,path:"/",domain:$j.session.host.cookieDomain})}else{$j.cookie("sharing_optout",false,{expires:-1,path:"/",domain:$j.session.host.cookieDomain})}if(this.isLoggedIn()){this[l]=!j;var k=$j.session.host.tokens[l];var h=j===true?"0":"1";var i=$j.uri($j.session.host.getAPIPath(false,true)+"users/SetToken");i.setParam("set",h);i.setParam("tokenId",k);$j.jsonp(i.assemble(),this,function(m){},{cache:false})}if(g===false){this.trigger("sharing_set")}};this.share=function(g){var h=g.connected;a.extend(g,{connected:{scope:this,callback:function(k){if(k&&k.id&&isNaN(k.id*1)===false){this.set_last_postId(k.id)}else{if(k&&k.error&&k.error.type==="OAuthException"){var j=typeof k.error.message==="string"?k.error.message:"";if(j.startsWith("(#3501)")){var i=j.split(" ");if(i.length>0&&isNaN(i[i.length-1]*1)===false){this.set_last_postId(i[i.length-1])}}}}h.callback.call(h.scope,k)}}});if(this.isFacebookSharing()){$j.fb.share(g)}};this.set_last_postId=function(g){this._last_fb_postId=g};this.unshare=function(g){if(isNaN(this._last_fb_postId*1)===false){$j.fb.unshare(this._last_fb_postId,g)}};this.stripProfanityNode=function(g){if(this.sailor){return g}a("*",g).andSelf().each(function(){if(this.nodeType==1&&a(this).text()){var h=a(this).html();var i=$j.session.user.stripProfanity(h);if(h!=i){a(this).html(i)}}})};this.stripProfanity=function(i){if(this.sailor){return i}var g="@!$%#";newtext=i.replace(/fuck|shit|asshole|cunt|cocksucker|nigger/gi,g);var h="@!$%#";newtext=newtext.replace(/matsu@\!\$%#a/ig,"matsushita");newtext=newtext.replace(/@\!\$%#rit/ig,"Shitrit");newtext=newtext.replace(/sma@\!\$%#s/gi,"smashits");newtext=newtext.replace(/al@\!\$%#eru/gi,"alshiteru");newtext=newtext.replace(/jin@\!\$%#an/gi,"jinshitan");newtext=newtext.replace(/yo@\!\$%#ake/gi,"yoshitake");newtext=newtext.replace(/s@\!\$%#/gi,"snigger");return newtext};this.getAvatar=function(g){if(!g){g=120}return this.avatar?$j.avatar.getSizedAvatarURL(window.location.protocol==="https:"?this.avatar_secure:this.avatar,g):$j.avatar.getDefaultAvatar()};this.getGroups=function(j,i){var h=[];if(j){for(var k=0;k<this.groups.length;k++){if($j.group_actions.isInGroup(this.groups[k].ass)){h.push(this.groups[k])}}}else{h=this.groups}if(i===true){return h.slice(0,$j.session.host.maxNations)}else{return h}};this.getGroup=function(h){if(!this.isLoggedIn()){return null}for(var i=0;i<this.groups.length;i++){if(this.groups[i]&&(this.groups[i].domainName==h)){return this.groups[i]}}return null};this.getGroupAss=function(g){var h=$j.session.user.getGroup(g);return(h?h.ass:null)};this.getURL=function(){if(this.url){return this.url}else{var g="http://"+this.domainName+"."+$j.session.host.getRoutingNode(".")+"newsvine.com";return g}};this.buildLink=function(){var g=a('<a href="'+this.getURL()+'">'+this.displayName+"</a>");return g};this.getNationAvails=function(){if(this.isLoggedIn()){var h=$j.session.host.maxNations;for(var i=0;i<this.groups.length;i++){if(this.groups[i]&&this.isFullMemberState(this.groups[i].ass)){h--}}}return h};this.isFullMemberState=function(g){if(!g){return false}return($j.session.host.ignoreStates.indexOf(g)===-1)};this.getGeoLocation=function(h,i){if(typeof h==="function"){i=h;h=null}var g=this;if(this.geo.city===null){$j.session.UserLoader.getUserData(function(j){g.geo.city=j.city;g.geo.country=j.country;g.geo.zip=j.zip;i.call(h,g.geo)})}else{i.call(h,this.geo)}};this.isRecentContent=function(j,i){if(!jQuery.isEmptyObject(this.latestThreads)){if(jQuery.makeArray(this.latestThreads).length&&this.latestThreads[j]){if(i&&this.latestThreads[j][i]){return this.latestThreads[j][i]}var h=0;for(var g in this.latestThreads[j]){if(this.latestThreads[j][g]>h){h=this.latestThreads[j][g]}}if(h){return h}}}return false}};$j.session.UserLoader={isRegisteredUser:function(){if(a.cookie("vid")==null){return false
}else{if(a.cookie("vid").charAt(0)!=="v"){return false}else{return true}}},getUserData:function(d,e){if(typeof d==="function"){e=d;d={}}var c=d.url||$j.session.host.getUserDataUrl(true,false);var b=this;$j.jsonp(c,function(f){e.call(this,f.data)},{cache:false})},init:function(b,c,d){if(typeof c==="function"){d=c;c={}}if($j.session.UserLoader.isRegisteredUser()===true){$j.session.UserLoader.getUserData(c,function(e){b.initFromKeyValues(e);d()})}else{if(c.default_user){b.initFromKeyValues(c.default_user);d()}}}}})(jQuery);(function(a){$j.namespace("$j.session");a.extend($j.session,{uri:false,host:false,user:false,poke:false,reportError:false,isReady:false,isWindowReady:false,config:{when_to_init:"after_window_ready"},loadConfig:function(){try{var b=a.parseJSON(a('meta[name="jenga-session-config"]').attr("content"));if(b){$j.session.config=a.extend(true,{},$j.session.config,b)}}catch(c){$j.log.warn("Failed to load jenga session config.")}},ready:function(d,c){if($j.session.isReady===true){try{d.call(c,$j.session.user)}catch(b){$j.log(b)}}else{$j.bind("$j.session.isReady",function(){try{d.call(c,$j.session.user)}catch(e){$j.log(e);if(e["get stack"]){$j.log(e["get stack"]())}}})}},windowReady:function(c,b){if($j.session.isWindowReady===true){c.call(b)}else{a(window).load(function(){c.call(b)})}},hostReady:function(c,b){if($j.session.host===false){$j.bind("$j.session.hostIsReady",function(){c.call(b,$j.session.host)})}else{c.call(b,$j.session.host)}},checkReady:function(){if($j.session.isReady===true){return true}else{if($j.session.host===false){return false}else{if($j.session.user===false){return false}else{$j.session.isReady=true;$j.trigger("$j.session.isReady");return true}}}},init_host:function(d,e){if(typeof HOSTCONFIG_SERVER!=="undefined"){var b=HOSTCONFIG_SERVER}else{if($j.session.uri.protocol==="https"){var b="https://www.newsvine.com/"}else{var b="http://www.polls.newsvine.com/"}}var c=b+"_api/hostConfig?remoteHost="+d;$j.jsonp(c,function(g){var f=new $j.session.HostConfig();f.initFromKeyValues(g);$j.session.host=f;if(typeof e==="function"){e.call(this)}$j.trigger("$j.session.hostIsReady");$j.session.checkReady()})},init_poke:function(){var b=new $j.session.Poke();b.init();$j.session.poke=function(){b.doPoke.apply(b,arguments)};$j.session.reportError=function(c){if($j.session.host&&$j.session.host.isDev()){$j.log("$j.session.reportError=",c)}};window.onerror=function(e,d,c){e=d+":"+c+":"+e;if(e.indexOf("xpopup")>-1){return}$j.session.reportError(e)}},init_elliott_tracking:function(){a(document).ready(function(){a("body").j_track()})},init_user:function(){var b=new $j.session.User();$j.session.UserLoader.init(b,{default_user:{loginState:0}},function(){$j.session.user=b;$j.session.checkReady()})},refresh_user:function(c){var b=new $j.session.User();$j.session.UserLoader.init(b,{default_user:{loginState:0}},function(){$j.session.user=b;if(c){c()}})},check_jquery_version:function(){var b=a().jquery;if(b&&b.length>=3){vernum=b.substr(0,3)*1;if(vernum<1.5){$j.log("ALERT... jenga requires at least jQuery 1.5.1 or newer. Best used with 1.6.3")}else{if(vernum<1.6){$j.log("WARNING... jenga may work with 1.5.x but has only been tested with 1.6.3")}}}},init:function(){if($j.session.isReady===true){return}$j.session.check_jquery_version();a(window).load(function(){$j.session.isWindowReady=true});$j.session.uri=$j.uri(location.href);if(typeof jenga_remote_host!=="undefined"){host=jenga_remote_host}else{if($j.session.uri.host==="file"){host="www.newsvine.com"}else{if($j.session.uri.host.indexOf(".")===-1){host="nbcnews.com"}else{host=$j.session.uri.host}}}$j.session.init_host(host,function(){$j.session.init_user()});$j.session.init_poke();$j.session.init_elliott_tracking()}});$j.session.loadConfig();$j.log("jQuery v",a().jquery,"; jenga v",3.51,$j.session.config.when_to_init);if($j.session.config.when_to_init==="asap"){$j.session.init()}else{if($j.session.config.when_to_init==="after_dom_ready"){a(document).ready(function(){$j.session.init()})}else{if($j.session.config.when_to_init==="after_window_ready"){a(window).load(function(){$j.session.isWindowReady=true;$j.session.init()})}}}$j.session.ready(function(b){$j.log("$j.session.isReady",$j.session);if(b.isLoggedIn()){$j.log("Hello, "+b.displayName,b)}else{$j.log("User is not logged in",b)}})})(jQuery);(function(a){$j.plugin("j_modal",function(b,c){var d={esckey:true,overlay:true,clickaway:true};this.$root=a(b);this.$overlay=false;this.options=a.extend(true,{},d,c);this.$root.addClass("j_modal");this.init=function(){this.toggle()};this.toggle=function(){if(this.$root.css("display")==="none"||this.$overlay===false){this.show()}else{this.hide()}};this.show=function(){if(this.options.esckey===true){this._keyup_bind()}if(this.options.overlay===true){this._overlay_show()}this.$root.css("display",this.$root.css("display"));this.$root.show();a("body").css("overflow","hidden")};this.hide=function(){if(this.options.esckey===true){this._keyup_unbind()}if(this.options.overlay===true){this._overlay_hide()}this.$root.hide();a("body").css("overflow","visible")};this._keyup_bind=function(){a(document).bind("keyup.j_modal",this,function(e){e.data._keyup_handle(e.keyCode)})};this._keyup_unbind=function(){a(document).unbind("keyup.j_modal")};this._keyup_handle=function(e){var f=27;if(e===f){this.hide()}};this._overlay_show=function(){this.$overlay=a('<div class="j_modal_overlay" />').appendTo(document.body);if(this.options.clickaway===true){this.$overlay.click(this,function(e){e.data.hide()})}};this._overlay_hide=function(){if(this.$overlay){this.$overlay.unbind("click");this.$overlay.remove();this.$overlay=null}}});$j.plugin("j_modal_target",function(b,c){var d=a(b);d.bind("click",function(e){e.preventDefault();a(d.attr("href")).j_modal()})},{autoload:true})})(jQuery);(function(a){$j.plugin("j_track",function(){var b={gaAccountId:"UA-547736-1",gaSampleRate:"100",siteName:"newsvine-beta"};this.init=function(){if((a('meta[name="trackData"]').length>0)){try{if(typeof $t=="undefined"){$t={trackData:a.parseJSON(a('meta[name="trackData"]').attr("content"))}}this.send_pageload_event()}catch(c){$j.log("tracking data error")}}};this.set_standard_track_data=function(){var c=new Array();c.gaAccountId=b.gaAccountId;c.gaSampleRate=b.gaSampleRate;c.siteName=b.siteName;c.typeName=$t.trackData.typeName?$t.trackData.typeName:"";return c};this.send_custom_event=function(c){var d=this.set_standard_track_data();d.eventType="pageaction";d.featureName=c.featureName;d.eventName=c.eventName?c.eventName:"";d.eventLabel=c.eventLabel?c.eventLabel:"";d.eventValue=c.eventValue?c.eventValue:null;d.nonInteraction=c.nontInteraction?c.nontInteraction:"";d.deviceType=$t.trackData.deviceType;EventTracker().track(d)};this.build_headline=function(){var c=document.title;c=c.replace("Newsvine Beta - ","");c=c.replace(" - Newsvine Beta","");return c};this.send_pageload_event=function(){var c=this;$j.session.ready(function(){var d=c.set_standard_track_data();d.section=$t.trackData.section?$t.trackData.section:"";d.subSection="";d.subSubSection="";d.subSubSubSection="";d.eventType="pageload";d.eventName="load";d.byline=$t.trackData.byline?$t.trackData.byline:"";d.elem="document";d.featureName="newsvinepage";d.sitePageId=$t.trackData.sitePageId;d.headline=c.build_headline();d.source="";d.zipCode=$j.session.user.geo.zip?$j.session.user.geo.zip:"";d.pageSource="";d.deviceType=$t.trackData.deviceType;d.isOriginalContent="true";EventTracker().track(d)})}})})(jQuery);(function(V){var E=V.fn.domManip,S="_tmplitem",F=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,U={},Q={},R,G={key:0,data:{}},O=0,T=0,K=[];function P(f,h,b,a){var j={data:a||(h?h.data:{}),_wrap:h?h._wrap:null,tmpl:null,parent:h||null,nodes:[],calls:B,nest:z,wrap:y,html:A,update:C};f&&V.extend(j,f,{nodes:[],parent:h});if(b){j.tmpl=b;j._ctnt=j._ctnt||j.tmpl(V,j);j.key=++O;(K.length?Q:U)[O]=j}return j}V.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){V.fn[a]=function(r){var q=[],o=V(r),e,p,c,d,f=this.length===1&&this[0].parentNode;R=U||{};if(f&&f.nodeType===11&&f.childNodes.length===1&&o.length===1){o[b](this[0]);q=this}else{for(p=0,c=o.length;p<c;p++){T=p;e=(p>0?this.clone(true):this).get();V.fn[b].apply(V(o[p]),e);q=q.concat(e)}T=0;q=this.pushStack(q,a,o.selector)}d=R;R=null;V.tmpl.complete(d);return q}});V.fn.extend({tmpl:function(e,f,a){return V.tmpl(this[0],e,f,a)},tmplItem:function(){return V.tmplItem(this[0])},template:function(a){return V.template(a,this[0])},domManip:function(n,a,b){if(n[0]&&n[0].nodeType){var m=V.makeArray(arguments),k=n.length,c=0,e;while(c<k&&!(e=V.data(n[c++],"tmplItem"))){}if(k>1){m[0]=[V.makeArray(n)]}if(e&&T){m[2]=function(d){V.tmpl.afterManip(this,d,b)}}E.apply(this,m)}else{E.apply(this,arguments)}T=0;!R&&V.tmpl.complete(U);return this}});V.extend({tmpl:function(i,f,g,l){var b,a=!l;if(a){l=G;i=V.template[i]||V.template(null,i);Q={}}else{if(!i){i=l.tmpl;U[l.key]=l;l.nodes=[];l.wrapped&&I(l,l.wrapped);return V(N(l,null,l.tmpl(V,l)))}}if(!i){return[]}if(typeof f==="function"){f=f.call(l||{})}g&&g.wrapped&&I(g,g.wrapped);b=V.isArray(f)?V.map(f,function(c){return c?P(g,l,i,c):null}):[P(g,l,i,f)];return a?V(N(l,null,b)):b},tmplItem:function(a){var d;if(a instanceof V){a=a[0]}while(a&&a.nodeType===1&&!(d=V.data(a,"tmplItem"))&&(a=a.parentNode)){}return d||G},template:function(d,a){if(a){if(typeof a==="string"){a=H(a)}else{if(a instanceof V){a=a[0]||{}}}if(a.nodeType){a=V.data(a,"tmpl")||V.data(a,"tmpl",H(a.innerHTML))}return typeof d==="string"?(V.template[d]=a):a}return d?typeof d!=="string"?V.template(null,d):V.template[d]||V.template(null,F.test(d)?d:V(d)):null},encode:function(b){return(""+b).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});V.extend(V.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(){U={}},afterManip:function(c,a,h){var g=a.nodeType===11?V.makeArray(a.childNodes):a.nodeType===1?[a]:[];h.call(c,a);J(g);T++}});function N(i,d,h){var a,j=h?V.map(h,function(b){return typeof b==="string"?i.key?b.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+S+'="'+i.key+'" $2'):b:N(b,i,b._ctnt)}):i;if(d){return j}j=j.join("");j.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(b,l,g,k){a=V(g).get();J(a);if(l){a=M(l).concat(a)}if(k){a=a.concat(M(k))}});return a?a:M(j)}function M(d){var a=document.createElement("div");a.innerHTML=d;return V.makeArray(a.childNodes)}function H(a){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+V.trim(a).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(k,n,o,u,w,v,t){var p=V.tmpl.tag[o],q,s,r;if(!p){throw"Template command not found: "+o}q=p._default||[];if(v&&!/\w$/.test(w)){w+=v;v=""}if(w){w=L(w);t=t?","+L(t)+")":v?")":"";s=v?w.indexOf(".")>-1?w+v:"("+w+").call($item"+t:w;r=v?s:"(typeof("+w+")==='function'?("+w+").call($item):("+w+"))"}else{r=s=q.$1||"null"}u=L(u);return"');"+p[n?"close":"open"].split("$notnull_1").join(w?"typeof("+w+")!=='undefined' && ("+w+")!=null":"true").split("$1a").join(r).split("$1").join(s).split("$2").join(u?u.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(g,h,e,f){f=f?","+f+")":e?")":"";return f?"("+h+").call($item"+f:g}):q.$2||"")+"_.push('"})+"');}return _;")}function I(d,a){d._wrap=N(d,true,V.isArray(a)?a:[F.test(a)?a:V(a).html()]).join("")}function L(b){return b?b.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function D(c){var d=document.createElement("div");d.appendChild(c.cloneNode(true));return d.innerHTML}function J(b){var c="_"+T,g,h,f={},r,a,q;for(r=0,a=b.length;r<a;r++){if((g=b[r]).nodeType!==1){continue}h=g.getElementsByTagName("*");for(q=h.length-1;q>=0;q--){d(h[q])}d(g)}function d(s){var v,t=s,n,u,l;if(l=s.getAttribute(S)){while(t.parentNode&&(t=t.parentNode).nodeType===1&&!(v=t.getAttribute(S))){}if(v!==l){t=t.parentNode?t.nodeType===11?0:t.getAttribute(S)||0:0;if(!(u=U[l])){u=Q[l];u=P(u,U[t]||Q[t],null,true);u.key=++O;U[O]=u}T&&w(l)}s.removeAttribute(S)}else{if(T&&(u=V.data(s,"tmplItem"))){w(u.key);U[u.key]=u;t=V.data(s.parentNode,"tmplItem");t=t?t.key:0}}if(u){n=u;while(n&&n.key!=t){n.nodes.push(s);n=n.parent}delete u._ctnt;delete u._wrap;V.data(s,"tmplItem",u)}function w(e){e=e+c;u=f[e]=f[e]||P(u,U[u.parent.key+c]||u.parent,null,true)}}}function B(f,g,h,e){if(!f){return K.pop()}K.push({_:f,tmpl:g,item:this,data:h,options:e})}function z(e,f,a){return V.tmpl(V.template(e),f,a,this)}function y(a,e){var f=a.options||{};f.wrapped=e;return V.tmpl(V.template(a.tmpl),a.data,f,a.item)}function A(e,f){var a=this._wrap;return V.map(V(V.isArray(a)?a.join(""):a).filter(e||"*"),function(b){return f?b.innerText||b.textContent:b.outerHTML||D(b)})}function C(){var a=this.nodes;V.tmpl(null,null,null,this).insertBefore(a[0]);V(a).remove()}})(jQuery);(function(a){$j.widget.Lightbox=$j.widget.AbstractWidget.extend(new function(){this.className="$j.widget.Lightbox";this.isOpen=false;this.$target=null;this.$target_overlay=null;this.$lightbox_overlay=null;this.$lightbox=null;this.options={style:"lightbox",event:"click",width:"auto",height:"auto",onClose:function(){this.hide()},nodes:{header:{close_button:true},section:{},footer:{}}};this.init=function(b){this.init_options(b);this.init_root_node(this.options);assets=this.options.assets||{css:true};this.load(assets,function(){this.$target=this.$root.parent();this.moveRoot("first_child");this.$target_overlay=this.init_target_overlay(this.$root,this.$target);this.$lightbox_overlay=this.init_lightbox_overlay(a(document.body));this.$lightbox=this.init_lightbox(a(document.body),this.options);this.target_overlay_bind({event:this.options.event});this.render(this.$lightbox,this.options.nodes)})};this.init_target_overlay=function(c,b){c=this.adjustParent(c);var d=a('<div class="target_overlay"/>').appendTo(c);c.css("position","relative");d.css("position","absolute");d.css("width",b.width());d.css("height",b.height());return d};this.init_lightbox_overlay=function(c){c=this.adjustParent(c);var b=a('<div class="lightbox_overlay"/>').appendTo(c);b.hide();b.hide();return b};this.init_lightbox=function(d,b){d=this.adjustParent(d);var c=a('<div class="lightbox"/>').appendTo(d);c.hide();if(b.style&&b.style!="lightbox"){d.parent().addClass(b.style)}if(this.auto_size_lightbox()===false){c.css("width",b.width);c.css("height",b.height)}return c};this.auto_size_lightbox=function(){if(typeof this.options.width==="number"&&typeof this.options.height==="number"){return false}else{return true}};this.center_lightbox=function(){var c=Math.floor((a(window).width()-this.$lightbox.outerWidth())/2);var b=Math.floor((a(window).height()-this.$lightbox.outerHeight())/2);this.$lightbox.css("left",c);this.$lightbox.css("top",b)};this.target_overlay_bind=function(){var b=this;this.$target_overlay.bind(this.buildEventKey(this.options.event),{scope:this},function(c){$j.widget.Lightbox.$target=b.$target;c.data.scope.target_overlay_handle();return false})};this.target_overlay_unbind=function(){this.$target_overlay.unbind(this.buildEventKey(this.options.event))};this.target_overlay_handle=function(){this.show()};this.keyup_bind=function(){a(document).bind(this.buildEventKey("keyup"),{scope:this},function(b){b.data.scope.keyup_handle(b.keyCode)})};this.keyup_unbind=function(){a(document).unbind(this.buildEventKey("keyup"))};this.keyup_handle=function(b){var c=27;switch(b){case c:this.hide();break;default:break}};this.clickaway_bind=function(){this.$lightbox_overlay.click({scope:this},function(b){b.data.scope.clickaway_handle(b.target)})};this.clickaway_unbind=function(){this.$lightbox_overlay.unbind("click")};this.clickaway_handle=function(b){if(this.$lightbox_overlay.attr("class").trim()===b.className.trim()){this.hide()}};this.show=function(){this.isOpen=true;this.center_lightbox();this.$lightbox_overlay.fadeTo(350,0.7);this.$lightbox.fadeTo(350,1);this.keyup_bind();this.clickaway_bind()};this.hide=function(){this.isOpen=false;if(this.$lightbox_overlay){this.$lightbox_overlay.fadeOut(350);this.$lightbox.fadeOut(350);this.keyup_unbind();this.clickaway_unbind()}};this.render_header_before=function(b){if(b.close_button){this.render_close_button(b.$root)}};this.render_section=function(b){this.load_plugins(b.$root,this.options.plugins)};this.render_footer_after=function(b){if(b.close_button){this.render_close_button(b.$root)}};this.render_close_button=function(c){var b=a('<div class="close_button"/>').appendTo(c);b.append("<button>close</button>");b.click(this,function(d){d.data.close()})};this.close=function(){if(this.isOpen){this.options.onClose.call(this)}};this.close_all=function(){a(".j_widget_lightbox .target_overlay").parent().parent().lightbox("close")}});$j.widget.Lightbox.$target=null;a.fn.lightbox=function(){return $j.PluginWrapper.handler($j.widget.Lightbox,this,arguments)}})(jQuery);(function(a){$j.widget.tester=$j.widget.AbstractWidget.extend(new function(){this.className="$j.widget.tester";this.options={assets:{css:false},nodes:{tester:{html:"testy testerson"}}}});a.fn.tester=function(){return $j.PluginWrapper.handler($j.widget.tester,this,arguments)}})(jQuery);(function(a){$j.widget.Zinger=$j.widget.AbstractWidget.extend(new function(){this.className="$j.widget.Zinger";this.options={logo:'<img src="//www.cdn.newsvine.com/_vine/images/__/icon_peacock.png" width="20" height="14" alt="" />',title:"",message:"",nodes:{header:{nodes:{logo:{},title:{},message:{}}},section:{},footer:{}}};this.default_lightbox_options={width:450,height:350};this.lightbox=function(c){var b=a.extend(true,this.default_lightbox_options,c);this._super(a.fn.zinger,c,b)};this.button=function(c){var b=a.extend(true,this.default_lightbox_options,c);this.lightbox_button(a.fn.zinger,c,b,c)};this.render_section=function(b){this.fb=new $j.widget.Zinger.Facebook(b.$root);this.fb.init();if(false){this.tw=new $j.widget.Zinger.Twitter(b.$root);this.tw.init();this.tw.onView(this.tw.VIEW_ENTER_EMAIL,this.on_twitter_view_change,this);this.tw.onView(this.tw.VIEW_CONNECT,this.reset_view,this)}this.nv=new $j.widget.Zinger.Newsvine(b.$root);this.nv.init();this.nv.onView(this.nv.VIEW_ENTER_PASSWORD,this.on_newsvine_view_change,this);this.nv.onView(this.nv.VIEW_ENTER_DISPLAYNAME,this.on_newsvine_view_change,this);this.nv.onView(this.nv.VIEW_ENTER_EMAIL,this.reset_view,this)};this.on_twitter_view_change=function(){if(this.fb){this.fb.$root.hide()}if(this.nv){this.nv.$root.hide()}};this.on_newsvine_view_change=function(){if(this.fb){this.fb.$root.hide()}if(this.tw){this.tw.$root.hide()}};this.reset_view=function(){if(this.fb){this.fb.$root.show()}if(this.tw){this.tw.$root.show()}if(this.nv){this.nv.$root.show()}};this.render_logo=function(b){if(this.options.logo!==false){b.$root.html(this.options.logo)}};this.render_title=function(b){b.$root.html(this.options.title)};this.render_message=function(b){b.$root.show();b.$root.html(this.options.message)}});a.fn.zinger=function(){return $j.PluginWrapper.handler($j.widget.Zinger,this,arguments)}})(jQuery);(function(a){$j.widget("j_login_check",function(){this.pluginInit=false;this.options={"title-msg":"To join the discussion, please sign in.",plugin:null};this._widgetInit=function(c){var b=this;$j.session.ready(function(){if($j.session.user&&$j.session.user.isLoggedIn()){}else{var d=b.$root.zinger("lightbox",{title:b.options["title-msg"]});b.$root.bind("click",function(){$j.log("here");setTimeout(function(){d.lightbox("show")},100)});$j.session.user.onLogin(b,function(e){d.lightbox("hide")})}if(!$j.session.user.isLoggedIn()){$j.session.user.onLogin(b,b.refresh)}})};this.refresh=function(){var b=this;$j.session.ready(function(){if($j.session.user&&$j.session.user.isLoggedIn()){if(!b.pluginInit){b.$root.unbind("click");var d=a(".j_widget_lightbox",b.$root);d.remove();b.pluginInit=true;if(b.options.plugin){var c=b.$root[b.options.plugin];if(typeof c==="function"){return c.call(b.$root,b.options)}else{$j.log(b.options.plugin+" is not a valid plugin")}}b.$root.focus()}}})}},{autoload:true})})(jQuery);(function(a){$j.widget.Zinger.Disconnect=$j.widget.AbstractWidget.extend(new function(){this.className="$j.widget.Zinger.Disconnect";this.getAssetPath=function(){return this._super().replace("/"+this.getWidgetName()+"/","/zinger/")};this.options={assets:{css:true,template:true},networks:[{enabled:false,network:"facebook",username:false,connect:{callback:function(){}},disconnect:{label:"Disconnect from Facebook",callback:function(){}}},{enabled:false,network:"twitter",username:false,connect:{callback:function(){}},disconnect:{label:"Disconnect from Twitter",callback:function(){}}}]};this.network_template=null;this.init=function(b){this.init_options(b);this.init_root_node(this.options);this.load(this.options.assets,function(c){if(c!==false){this.before_render_template(c);c=this.render_template(c);this.after_render_template(c)}})};this.render_template=function(b){var c={options:this.options};var b=a.tmpl(b,c).appendTo(this.$root);return b};this.before_render_template=function(b){this.network_template=b.find(".j-networks").template();b.find(".j-networks").empty()};this.after_render_template=function(b){$root=b.parent();$networks=$root.find(".j-networks");for(var c=0;c<this.options.networks.length;c++){if(this.options.networks[c].enabled===true){this.render_network($networks,this.network_template,this.options.networks[c])}}};this.render_network=function(e,b,c){var d={network:c};c.$root=a.tmpl(b,d).appendTo(e);if(c.username){this.network_is_connected(c.$root)}c.$root.find(".j-connect")["zinger_"+c.network]({scope:this,connected_callback:function(f){this.network_is_connected(c.$root);if(a.isFunction(c.connect.callback)===true){c.connect.callback.call(this)}}});c.$root.find(".j-disconnect").click(this,function(g){try{g.data.handle_disconnect_click(c)}catch(f){}return false})};this.network_is_connected=function(b){b.addClass("c-connected")};this.handle_disconnect_click=function(b){this.send_disconnect(b,function(){b.$root.removeClass("c-connected")})};this.send_disconnect=function(d,e){var b=$j.session.uri.protocol==="https";var c=$j.uri($j.session.host.getAPIPath(b,true)+"accounts/auth/"+d.network+"Login");c.setParam("delete",1);$j.jsonp(c.assemble(),this,function(f){e.call(this);if(a.isFunction(d.disconnect.callback)===true){d.disconnect.callback.call(this)}},{cache:false})}});a.fn.zinger_disconnect=function(){return $j.PluginWrapper.handler($j.widget.Zinger.Disconnect,this,arguments)}})(jQuery);(function(a){$j.fb();$j.widget.Zinger.Facebook=$j.widget.AbstractWidget.extend(new function(){this.className="$j.widget.Zinger.Facebook";this.$button=null;this.$controls=null;this.getAssetPath=function(){return this._super().replace("/"+this.getWidgetName()+"/","/zinger/")};this.options={perms:null,scope:null,connected_callback:null,force_sharing:false,enable_sharing_checkbox:true,messages:{button_label:"Connect with Facebook"},assets:{css:true},nodes:{controls:{}}};this.getPerms=function(){if(this.options.perms===null){$j.log("getting perms from FBClient=",$j.ext.FacebookClient.getPerms());return $j.ext.FacebookClient.getPerms()}else{$j.log("using defined perms=",this.options.perms);return this.options.perms}};this.render_controls=function(b){this.$controls=b.$root;$j.fb(function(d){this.$button=a('<a class="zinger_fb_button zinger_fb_button_medium"><span class="zinger_fb_button_text">'+this.options.messages.button_label+"</span></a>").appendTo(this.$controls);if(window.location.protocol==="https:"){var c=$j.session.host.getPeacockRoot()+"jenga/widget/zinger/images/fb.png";this.$button.css("background-image","url("+c+")");this.$button.find(".zinger_fb_button_text").css("background-image","url("+c+")")}if(this.options.enable_sharing_checkbox===true){this.render_sharing_checkbox(this.$controls)}this.$button.click(this,function(e){e.preventDefault();e.data.handle_facebook_button_click()})},this)};this.render_sharing_checkbox=function(b){if($j.session.user.access.isFBS()===true){if($j.session.host.sharingVariable!==null){b.zinger_sharing()}}};this.handle_facebook_button_click=function(){if(this.options.force_sharing){$j.session.user.setSharing(true,true)}var c=this;var b=this.getPerms();FB.login(function(d){$j.log("getLoginStatus",d,d.status);$j.ext.FacebookClient.updateResponse(d);if(d.status==="connected"){$j.log("connected to FB");$j.fb.hasPerms(b,function(){this.newsvine_login_using_facebook(d);this.connected_callback(d)},function(){$j.log("cancelled request for permissions")},c)}else{$j.log("NOT connected to FB");FB.Event.subscribe("auth.login",function(h){try{var f="http://www.newsvine.com/_action/admin/debug?subj=fb-auth-login&msg=yes&url="+location.href.urlencode();$j.jsonp(f)}catch(g){}$j.ext.FacebookClient.updateResponse(h);$j.fb.hasPerms(b,function(){this.newsvine_login_using_facebook(h);this.connected_callback(h)},function(){$j.log("cancelled request for permissions")},c)})}},{scope:b})};this.connected_callback=function(b){if(a.isFunction(this.options.connected_callback)){var c=this.options.scope||this;this.options.connected_callback.call(c,b)}};this.newsvine_login_using_facebook=function(b){var c=$j.session.host.getRegDomainRoot()+"_nv/api/accounts/auth/facebookLogin?";c+="multiDomainLogin=true";c+="&token="+b.authResponse.accessToken;c+="&redirect="+"/_api/user/getUserData?multiDomainLogin=true".urlencode();$j.jsonp(c,function(d){if(d.statusCode==="success"){if($j.cookie("sharing_optout")==="true"){$j.session.user.setSharing(false)}$j.session.user.login(d.data)}},{cache:false})}});a.fn.zinger_facebook=function(){return $j.PluginWrapper.handler($j.widget.Zinger.Facebook,this,arguments)}})(jQuery);(function(a){$j.widget("j_zinger_inline",function(){this.options={redirect:false};this._render=function(){$j.session.ready(function(b){this.$root.zinger(this.options);b.onLogin(this,function(c){if(this.options.redirect!==false){location.href=this.options.redirect}else{$j.log("User logged in successfully but no redirect has been set.")}})},this)}},{autoload:true})})(jQuery);(function(a){$j.widget.Zinger.Login=$j.widget.AbstractWidget.extend(new function(){this.className="$j.widget.Zinger.Login";this.getAssetPath=function(){return this._super().replace("/"+this.getWidgetName()+"/","/zinger/")};this.options={edition:false,logged_in_mode:"menu",logged_out_mode:"menu",assets:{css:true,template:true},target:{avatar_size:20,bind_event:"click",label:"Account"},menu:{avatar_size:60,column:"My Column",settings:"Account Settings",logout:"Log out"},zinger:{title:"Log in or register below"},effects:{target_open:{effect:"slideDown",duration:400},target_close:{effect:"slideUp",duration:400}}};this.$target=null;this.$menu=null;this.$login=null;this.init=function(b){this.init_options(b);this.init_root_node(this.options);this.load(this.options.assets,function(c){if(c!==false){this.before_render_template(c);c=this.render_template(c);this.after_render_template(c)}})};this.render_template=function(b){var c={options:this.options,user:$j.session.user};var b=a.tmpl(b,c).appendTo(this.$root);return b};this.before_render_template=function(b){};this.after_render_template=function(b){this.$target=this.$root.find(".j-target");this.$menu=this.$root.find(".j-menu");this.$login=this.$root.find(".j-login-prompt");this.$target.data("node",false);this.target_bind();this.render_menu();this.$login.find(".j-zinger-login").zinger(this.options.zinger);if($j.session.user.isLoggedIn()===false&&this.options.logged_out_mode==="inline"){this.$target.hide();this.$login.show()}else{if($j.session.user.isLoggedIn()===true&&this.options.logged_in_mode==="inline"){this.$target.hide();this.$menu.show()}}$j.session.user.onLogin(this,function(d){this.render_menu();if(this.options.logged_out_mode==="inline"){this.$login.hide();this.$target.show()}else{this.$login.find(".j_widget_zinger").hide();this.$login.find(".j-onlogin").removeClass("c-hide");var c=this;setTimeout(function(){c.toggle("slideUp")},2000)}if(this.options.logged_in_mode==="inline"){this.$menu.show();this.$target.hide()}})};this.render_menu=function(){this.$menu.find(".j-user-displayName").html($j.session.user.displayName);this.add_avatar(this.$target.find("img.j-avatar"),this.options.target.avatar_size);this.add_avatar(this.$menu.find("img.j-avatar"),this.options.menu.avatar_size);var b=this.sync_facebook();if(b===false){this.render_fb_sharing()}this.menu_links()};this.target_bind=function(){this.$target.bind(this.options.target.bind_event,{scope:this},function(b){b.data.scope.target_handle()})};this.target_handle=function(){this.toggle()};this.toggle=function(d){if(typeof d==="undefined"){d=this.$target.data("node")?"hide":"show"}var b=this.$target.data("node");if(b===false){b=$j.session.user.isLoggedIn()?this.$menu:this.$login}if(d==="show"){var c=this.options.effects.target_open;this.$target.data("node",b);this.before_show();this.$target.addClass("c-focus")}else{var c=this.options.effects.target_close;this.$target.data("node",false);this.$target.removeClass("c-focus");this.before_hide()}b[c.effect](c.duration)};this.before_show=function(){this.clickaway_bind()};this.before_hide=function(){this.clickaway_unbind()};this.clickaway_bind=function(){a(document.body).bind(this.buildEventKey("click"),{scope:this},function(b){b.data.scope.clickaway_handle(b.target)})};this.clickaway_unbind=function(){a(document.body).unbind(this.buildEventKey("click"))};this.clickaway_handle=function(b){if(a(b).closest("#"+this.getWidgetNodeId()).size()===0){this.toggle("hide")}};this.render_fb_sharing=function(){if($j.session.user.access.isFBS()===true){if($j.session.host.sharingVariable!==null){var b=this.$menu.find(".j-fb-share");b.zinger_sharing()}}};this.sync_facebook=function(){var b=this.$menu.find(".j-syncfb");if($j.session.user.hasFacebookAff()===false){b.removeClass("c-hide");b.find(".j-zinger-fb").zinger_facebook({messages:{button_label:"Connect with Facebook"},connected_callback:function(){b.find(".j-connect").hide();b.find(".j-zinger-fb").hide();b.find(".j-connected").removeClass("c-hide");b.find(".j-connected").delay(3000).slideUp("slow")}});return true}else{b.find(".j-connect").hide();b.find(".j-zinger-fb").hide();b.find(".j-connected").removeClass("c-hide");return false}};this.menu_links=function(){var b=this.options.menu;var c=this.$menu;if(b.column){c.find("a.j-user-column").attr("href",$j.session.user.getURL())}else{c.find("a.j-user-column").parent().remove()}if(b.settings){c.find("a.j-user-settings").attr("href",$j.session.host.getAccountSettingsPath())}else{c.find("a.j-user-column").parent().remove()}if(b.logout){c.find("a.j-user-logout").attr("href",$j.session.host.getLogoutUrl())}else{c.find("a.j-user-column").parent().remove()}};this.add_avatar=function(c,b){if(c&&b){var d=b;c.attr("src",$j.session.user.getAvatar(d));c.attr("width",b).attr("height",b).attr("alt","Your Avatar")}}});a.fn.zinger_login=function(){return $j.PluginWrapper.handler($j.widget.Zinger.Login,this,arguments)}})(jQuery);(function(a){$j.widget("j_zinger_menu",function(){this.options={};this._render=function(){$j.session.ready(function(b){this.$root.zinger_login(this.options)},this)}},{autoload:true})})(jQuery);(function(a){$j.widget.Zinger.MultiConnect=$j.widget.AbstractWidget.extend(new function(){this.className="$j.widget.Zinger.MultiConnect";this.getAssetPath=function(){return this._super().replace("/"+this.getWidgetName()+"/","/zinger/")};this.options={assets:{css:true,template:true},title:"Hold on! You're almost there&hellip;",subtitle:"You chose additional sharing options:",message:"<p>You must first connect your account(s) to share your thoughts further:</p>",footer:'<p>You can always change <a class="j-acct-link">Your Account Settings</a> later.</p>',networks:[{enabled:false,network:"facebook",user_connected:false,message:"",connected:{message:"",callback:function(){}},not_connected:{message:"",callback:function(){}}},{enabled:false,network:"twitter",user_connected:false,message:"",connected:{message:"",callback:function(){}},not_connected:{message:"",callback:function(){}}}]};this.default_lightbox_options={width:500,height:390};this.network_template=null;this.lightbox=function(c){var b=a.extend(true,this.default_lightbox_options,c);this._super(a.fn.zinger_multiconnect,c,b)};this.init=function(b){this.init_options(b);this.init_root_node(this.options);this.load(this.options.assets,function(c){if(c!==false){this.before_render_template(c);c=this.render_template(c);this.after_render_template(c)}})};this.render_template=function(b){var c={options:this.options};var b=a.tmpl(b,c).appendTo(this.$root);return b};this.before_render_template=function(b){this.network_template=b.find(".j-networks").template();b.find(".j-networks").empty()};this.after_render_template=function(b){$root=b.parent();$root.find(".j-acct-link").attr("href",$j.session.host.getAccountSettingsPath());$root.find(".j-close").click(function(){a("<div/>").lightbox("close_all")});$networks=this.$root.find(".j-networks");for(var c=0;c<this.options.networks.length;c++){if(this.options.networks[c].enabled===true){this.render_network($networks,this.network_template,this.options.networks[c])}}};this.render_network=function(f,c,d){var e={network:d};var b=a.tmpl(c,e).appendTo(f);if(d.user_connected===true){this.network_is_connected(b)}b.find(".j-connect")["zinger_"+d.network]({scope:this,connected_callback:function(g){$j.log("OK TO POST MY COMMENT",this);$j.log("............... this is not done.................",this);this.network_is_connected(b);if(a.isFunction(d.connected.callback)===true){d.connected.callback.call(this)}}})};this.network_is_connected=function(b){b.addClass("c-done")}});a.fn.zinger_multiconnect=function(){return $j.PluginWrapper.handler($j.widget.Zinger.MultiConnect,this,arguments)}})(jQuery);(function(a){$j.widget.Zinger.Newsvine=$j.widget.AbstractWidget.extend(new function(){this.className="$j.widget.Zinger.Newsvine";this.$header=null;this.$footer=null;this.$status=null;this.$enter_email_form=null;this.$enter_password_form=null;this.$enter_displayname_form=null;this.$enter_reset_form=null;this.VIEW_ENTER_EMAIL=1;this.VIEW_ENTER_PASSWORD=2;this.VIEW_ENTER_DISPLAYNAME=3;this.VIEW_RESET_PASS=4;this.VIEW_RESET_DONE=5;this.check_displayname_value="";this.getAssetPath=function(){return this._super().replace("/"+this.getWidgetName()+"/","/zinger/")};this.options={messages:{email:"&hellip;or just your e-mail address:",displayName:'<h2 class="success">Great!</h2> <p> Now we just need to know what name you\'d like to have on the site (e.g. John Smith, antelope123, Tim from Seattle):</p>',password:'<h2 class="success">Excellent!</h2> <p>It looks like you already have an account registered with <span class="email">that email address</span>.</p><p> Please type in your password below:</p>',reset_pass:"<p>Enter the e-mail address you registered with and we will send you an e-mail to reset your password. </p>",reset_done:"<p>An e-mail has been sent to your Inbox. Please follow the instructions in the email to reset your password.</p>"},nodes:{header:{},controls:{nodes:{enter_email:{nodeType:"form"},enter_password:{nodeType:"form"},enter_displayname:{nodeType:"form"},enter_resetpass:{nodeType:"form"}}},status:{},footer:{nodes:{reset_password:{html:'<a href="#">Forgot your password</a>?'},register_new:{html:'<a href="#">Register a new account</a>.'},contact_us:{html:'<a href="http://www.newsvine.com/_nv/cms/info/contact?subj=loginproblem">Contact us</a> to report a problem.'},start_over:{html:'Or, <a href="#">start over</a>.'}}}}};this.after_render=function(b){this.view(this.VIEW_ENTER_EMAIL)};this.render_header=function(b){this.$header=b.$root;this.$header.showView=function(c){$header=this.show();if(c){$header.html(c)}}};this.render_footer=function(b){this.$footer=b.$root;a("div.reset_password a").click(this,function(d){try{d.data.view(d.data.VIEW_RESET_PASS)}catch(c){$j.session.reportError(c)}return false});a("div.start_over a").click(this,function(d){try{d.data.view(d.data.VIEW_ENTER_EMAIL)}catch(c){$j.session.reportError(c)}return false});a("div.register_new a").click(this,function(d){try{d.data.view(d.data.VIEW_ENTER_EMAIL)}catch(c){$j.session.reportError(c)}return false});this.$footer.showView=function(c){var c=a.extend({reset_password:true,register_new:false,contact_us:false,start_over:true},c);$footer=this.show();if(c.reset_password){$footer.children("div.reset_password").show()}else{$footer.children("div.reset_password").hide()}if(c.start_over){$footer.children("div.start_over").show()}else{$footer.children("div.start_over").hide()}if(c.register_new){$footer.children("div.register_new").show()}else{$footer.children("div.register_new").hide()}if(c.contact_us){$footer.children("div.contact_us").show()}else{$footer.children("div.contact_us").hide()}}};this.render_status=function(b){this.$status=b.$root};this.clear_status=function(){this.update_status("","");this.$status.hide()};this.update_status=function(b,c){this.$status.html(b);this.$status.attr("class","status "+c);this.$status.show()};this.render_enter_email=function(b){this.$enter_email_form=b.$root;this.$enter_email_form.append('<input type="text" class="email" name="email" placeholder="you@email.com" />');this.$enter_email_form.append('<input type="submit" name="submit" value="Submit" />');this.$enter_email_form.submit(this,function(d){try{d.data.handle_enter_email()}catch(c){$j.session.reportError(c)}return false});this.$enter_email_form.showView=function(){$form=this.show();$form.children("input.email").focus()}};this.handle_enter_email=function(){var b=this.get_user_email_input();if($j.util.validate_domain(b,2)===true){this.check_domain_taken(b,this,function(c){this.handle_domain_taken(c)});return}else{if($j.util.validate_email(b)===false){this.update_status("Please enter a valid e-mail address.","error");return}}this.check_email_taken(b,this,function(c){this.handle_email_taken(c)})};this.get_user_display_input=function(){var b=a("input.displayName",this.$enter_displayname_form).val().trim();return b};this.get_user_email_input=function(){var b=a("input.email",this.$enter_email_form).val().trim();return b};this.render_enter_resetpass=function(b){this.$enter_reset_form=b.$root;this.$enter_reset_form.append('<input type="email" class="email" name="email" placeholder="you@email.com" />');this.$enter_reset_form.append('<input type="submit" name="submit" value="Send Email" />');this.$enter_reset_form.submit(this,function(d){try{d.data.handle_enter_resetpass()}catch(c){$j.session.reportError(c)}return false});this.$enter_reset_form.showView=function(c){$form=this.show();$form.children("input.email").focus();if($j.util.validate_email(c)){$form.children("input.email").val(c)}}};this.handle_enter_resetpass=function(){var c=a("input.email",this.$enter_reset_form).val();if($j.util.validate_email(c)===false){this.update_status("Please enter a valid e-mail address.","error");return}var b=$j.session.host.getResetPassUrl(c,$j.session.host.getUserDataUrl(true));$j.jsonp(b,this,function(d){this.view(this.VIEW_RESET_DONE)},{cache:false})};this.render_enter_password=function(b){this.$enter_password_form=b.$root;this.$enter_password_form.append('<input type="password" class="password" name="password" placeholder="Password" />');this.$enter_password_form.append('<input type="submit" name="submit" value="Submit" />');this.$enter_password_form.submit(this,function(d){try{d.data.handle_enter_password()}catch(c){$j.session.reportError(c)}return false});this.$enter_password_form.showView=function(){$form=this.show();var c=$form.children("input.password");c.val("").focus()}};this.handle_enter_password=function(){var b=this.get_user_email_input();var c=a("input.password",this.$enter_password_form).val();if($j.util.validate_password(c)===false){this.update_status("Please enter a valid e-mail address and password.","error");return}this.send_email_login(b,c,this,function(d){this.handle_email_login(d.statusCode,d.data)})};this.render_enter_displayname=function(b){this.$enter_displayname_form=b.$root;this.$enter_displayname_form.append('<input type="text" class="displayName" name="displayName" placeholder="Your Public Name" />');this.$enter_displayname_form.append('<input type="submit" name="submit" value="Submit" />');this.$enter_displayname_form.submit(this,function(d){try{d.data.handle_enter_displayname()}catch(c){$j.session.reportError(c)}return false});this.$enter_displayname_form.find("input.displayName").keyup(this,function(c){c.data.handle_displayname_input()});this.$enter_displayname_form.showView=function(){$form=this.show();$form.children("input.displayName").focus()}};this.handle_displayname_input=function(){var b=this.get_user_display_input();if($j.util.validate_display(b)===true&&this.check_displayname_value!==b){this.check_displayname_value=b;this.check_display_taken(b,this,function(c){if(c.statusCode===1){this.update_status("Name is available!","success")}else{if(c.statusCode===-4){this.update_status("Name is not available.","error")}else{this.clear_status()}}})}};this.handle_enter_displayname=function(){var c=this.get_user_email_input();var b=this.get_user_display_input();if($j.util.validate_display(b)===false){this.update_status("Please enter a valid display name. Display names must be at least 4 characters but not longer than 60.","error");return}this.check_display_taken(b,this,function(d){this.handle_display_taken(d)})};this.check_email_taken=function(c,d,e){var b=$j.session.host.getAPIPath(true)+"user/emailTaken?";b+="email="+c.urlencode();$j.jsonp(b,d,e,{cache:false})};this.check_domain_taken=function(c,d,e){var b=$j.session.host.getAPIPath(true)+"user/domainTaken?";b+="domain="+c.urlencode();$j.jsonp(b,d,e,{cache:false})};this.handle_domain_taken=function(b){if(b.isTaken===true){this.view(this.VIEW_ENTER_PASSWORD)
}else{this.update_status("Please enter a valid e-mail address.","error");return}};this.handle_email_taken=function(b){if(b.emailTaken===true){this.view(this.VIEW_ENTER_PASSWORD)}else{this.view(this.VIEW_ENTER_DISPLAYNAME)}};this.send_email_login=function(b,e,c,g){var d=$j.uri($j.session.host.getAPIPath(true,true)+"accounts/login");d.setParam("responseType","json");d.setParam("email",b);d.setParam("password",e);if(window.location.protocol==="https:"){var f=$j.session.uri.getParam("redirect",window.location.href);d.setParam("redirect",f);d.setParam("responseType","redirect");window.location.href=d.assemble()}else{$j.jsonp(d.assemble(),c,g,{cache:false})}};this.handle_email_login=function(e,f){if(e==="success"){this.$root.hide();$j.session.user.login(f)}else{var d=f.errors?"":"Login was unsuccessful. Please try again.";for(var c in f.errors){var b=f.errors[c];if(b){d+="<div>"+b+"</div>"}}this.update_status(d,"error")}};this.check_display_taken=function(b,d,e){var c=$j.session.host.getNewsvineRoot()+"_action/section/checkName?";c+="displayName="+b.urlencode();$j.jsonp(c,d,e,{cache:false})};this.handle_display_taken=function(d){if(d.statusCode===1){var c=this.get_user_email_input();var b=this.get_user_display_input();this.send_quick_reg(c,b,this,function(e){this.handle_quick_reg(e.statusCode,e.data)})}else{if(d.statusCode===-4){this.update_status("Sorry, that name is not available.","error");return}else{this.update_status("Please enter a valid name.","error");return}}};this.send_quick_reg=function(c,b,d,f){$j.log("....... CALLING QUICK REG......");var e=$j.uri($j.session.host.getAPIPath(true,true)+"accounts/register");e.setParam("responseType","redirect");e.setParam("redirect",$j.session.host.getUserDataUrl(true));e.setParam("email",c);e.setParam("displayName",b);$j.jsonp(e.assemble(),d,f,{cache:false})};this.handle_quick_reg=function(e,f){if(e==="success"){this.$root.hide();$j.session.user.login(f)}else{var d=f.errors?"":"Registration was unsuccessful. Please try again.";for(var c in f.errors){var b=f.errors[c];if(b){d+="<div>"+b+"</div>"}}this.update_status(d,"error");this.$footer.showView({reset_password:false,register_new:false,contact_us:true,start_over:true})}};this.onView=function(b,d,c){this.bind("view_"+b,function(){d.call(c)})};this.view=function(c){this.clear_status();a("form",this.$root).hide();this.trigger("view_"+c);if(c===this.VIEW_ENTER_EMAIL){this.$header.showView(this.options.messages.email);this.$enter_email_form.showView();this.$footer.hide()}else{if(c===this.VIEW_ENTER_PASSWORD){this.$header.showView(this.options.messages.password);this.$enter_password_form.showView();this.$footer.showView();var b=this.get_user_email_input();if(b){a("span.email",this.$header).text(b)}}else{if(c===this.VIEW_ENTER_DISPLAYNAME){this.$header.showView(this.options.messages.displayName);this.$enter_displayname_form.showView();this.$footer.showView({reset_password:false})}else{if(c===this.VIEW_RESET_PASS){this.$header.showView(this.options.messages.reset_pass);this.$enter_reset_form.showView(this.get_user_email_input());this.$footer.showView({reset_password:false,register_new:true,start_over:true})}else{if(c===this.VIEW_RESET_DONE){this.$header.showView(this.options.messages.reset_done);this.$enter_reset_form.hide();this.$footer.showView({reset_password:false,register_new:true,start_over:true})}}}}}}});a.fn.zinger_newsvine=function(){return $j.PluginWrapper.handler($j.widget.Zinger.Newsvine,this,arguments)}})(jQuery);(function(a){$j.widget.Zinger.Sharing=$j.widget.AbstractWidget.extend(new function(){this.className="$j.widget.Zinger.Sharing";this.getAssetPath=function(){return this._super().replace("/"+this.getWidgetName()+"/","/zinger/")};this.options={assets:{css:true,template:true},affiliateLabel:null};this.$checkbox=null;this.init=function(b){if($j.session.host.sharingVariable===null){return}this.init_options(b);this.init_root_node(this.options);this.load(this.options.assets,function(c){if(c!==false){this.before_render_template(c);c=this.render_template(c);this.after_render_template(c)}})};this.render_template=function(b){var c={options:this.options,user:$j.session.user};var b=a.tmpl(b,c).appendTo(this.$root);return b};this.before_render_template=function(b){if(!this.options.affiliateLabel){this.options.affiliateLabel=$j.session.host.domainRootLabel}};this.after_render_template=function(c){var b=$j.session.user;this.$checkbox=this.$root.find("input");if(typeof this.$checkbox.prop==="function"){this.$checkbox.prop("checked",b.isSharing())}else{this.$checkbox.attr("checked",b.isSharing())}this.$checkbox.click(this,function(f){if(typeof a(this).prop==="function"){b.setSharing(a(this).prop("checked"))}else{b.setSharing(a(this).attr("checked"))}});b.onSharingSet(this,function(f){$j.log("updating share state; ",this,f,f.isSharing());if(typeof this.$checkbox.prop==="function"){this.$checkbox.prop("checked",f.isSharing())}else{this.$checkbox.attr("checked",f.isSharing())}});var e=$j.session.host.domainRootLabel;if(e==="TODAY"){var d="http://today.msnbc.msn.com/id/46329902"}else{if(e==="msnbc.com"||e==="nbcnews.com"){var d="http://www.msnbc.msn.com/id/46385532"}}this.$root.find(".j-what").attr("href",d)}});a.fn.zinger_sharing=function(){return $j.PluginWrapper.handler($j.widget.Zinger.Sharing,this,arguments)}})(jQuery);(function(a){$j.widget.Zinger.Twitter=$j.widget.AbstractWidget.extend(new function(){this.className="$j.widget.Zinger.Twitter";this.$header=null;this.$footer=null;this.$status=null;this.$button=null;this.VIEW_CONNECT=1;this.VIEW_ENTER_EMAIL=2;this.VIEW_RESET_PASS=3;this.VIEW_RESET_DONE=4;this.getAssetPath=function(){return this._super().replace("/"+this.getWidgetName()+"/","/zinger/")};this.options={scope:null,connected_callback:null,img_url:null,messages:{email:'<h2 class="success">Great!</h2> <p>Now we just need your e-mail address to complete the connect:</p>',reset_pass:"<p>Enter the e-mail address you registered with and we will send you an e-mail to reset your password. </p>",reset_done:"<p>An e-mail has been sent to your Inbox. Please follow the instructions in the email to reset your password.</p>"},nodes:{header:{},controls:{nodes:{enter_email:{nodeType:"form"},connect:{nodeType:"form"},enter_resetpass:{nodeType:"form"}}},status:{},footer:{nodes:{reset_password:{html:'<a href="#">Forgot your password</a>?'},start_over:{html:'Or, <a href="#">start over</a>.'}}}}};this.after_render=function(b){this.view(this.VIEW_CONNECT)};this.render_connect=function(b){var c=this.options.img_url!==null?this.options.img_url:$j.session.host.mediaPath+"/_vine/images/__/sign-in-with-twitter-l.png";this.$connect_form=b.$root;$j.tw(function(d){this.$button=a('<img src="'+c+'" alt="Sign in with twitter" />').appendTo(this.$connect_form);this.$button.css("cursor","pointer");this.$button.click(this,function(e){e.data.handle_twitter_button_click()})},this);this.$connect_form.showView=function(){$form=this.show()}};this.handle_twitter_button_click=function(){$j.tw(function(c){$j.log("T.isConnected=",c.isConnected(),c.currentUser);if(c.isConnected()){$j.log("LOGGED INTO TWITTER!");this.newsvine_login_using_twitter(c)}else{$j.log("LOGGED OUT OF TWITTER!");c.signIn();c.unbind("authComplete");var b=this;c.bind("authComplete",function(f,d,e){$j.log("T.authComplete......... T.isConnected=",c.isConnected());b.newsvine_login_using_twitter(c)})}},this)};this.connected_callback=function(b){if(a.isFunction(this.options.connected_callback)){var c=this.options.scope||this;this.options.connected_callback.call(c,b)}};this.newsvine_login_using_twitter=function(c){var d=$j.uri($j.session.host.getAPIPath(true,true)+"accounts/auth/twitterLogin");d.setParam("domainRoot",$j.session.host.getDomainRoot());d.setParam("redirect","/_api/user/getUserData?multiDomainLogin=true");var b=this.get_user_email_input();if(b!==""){d.setParam("email",b)}$j.log("T.currentUser=",c.currentUser,d.assemble());$j.jsonp(d.assemble(),this,function(e){if(e.statusCode==="success"){$j.session.user.login(e.data);this.connected_callback(c)}else{if(e.data&&e.data.errors&&e.data.errors.R14){this.view(this.VIEW_ENTER_EMAIL)}else{alert('Error code "CPE-720". Unable to register using Twitter credentials. Please try again or contact us at http://www.newsvine.com/_nv/cms/info/contact to report the issue.')}}},{cache:false})};this.render_header=function(b){this.$header=b.$root;this.$header.showView=function(c){$header=this.show();if(c){$header.html(c)}}};this.render_footer=function(b){this.$footer=b.$root;a("div.reset_password a").click(this,function(d){try{d.data.view(d.data.VIEW_RESET_PASS)}catch(c){$j.session.reportError(c)}return false});a("div.start_over a").click(this,function(d){try{d.data.view(d.data.VIEW_CONNECT)}catch(c){$j.session.reportError(c)}return false});this.$footer.showView=function(c){var c=a.extend({reset_password:true,start_over:true},c);$footer=this.show();if(c.reset_password){$footer.children("div.reset_password").show()}else{$footer.children("div.reset_password").hide()}if(c.start_over){$footer.children("div.start_over").show()}else{$footer.children("div.start_over").hide()}}};this.render_status=function(b){this.$status=b.$root};this.clear_status=function(){this.update_status("","")};this.update_status=function(b,c){this.$status.html(b);this.$status.attr("class","status "+c)};this.render_enter_email=function(b){this.$enter_email_form=b.$root;this.$enter_email_form.append('<input type="text" class="email" name="email" placeholder="you@email.com" />');this.$enter_email_form.append('<input type="submit" name="submit" value="Submit" />');this.$enter_email_form.submit(this,function(d){try{d.data.handle_enter_email()}catch(c){$j.session.reportError(c)}return false});this.$enter_email_form.showView=function(){$form=this.show();$form.children("input.email").focus()}};this.handle_enter_email=function(){var b=this.get_user_email_input();if($j.util.validate_email(b)===false){this.update_status("Please enter a valid e-mail address.","error");return}this.check_email_taken(b,this,function(c){this.handle_email_taken(c)})};this.get_user_email_input=function(){var b=a("input.email",this.$enter_email_form).val().trim();return b};this.check_email_taken=function(c,d,e){var b=$j.session.host.getAPIPath(true)+"user/emailTaken?";b+="email="+c.urlencode();$j.jsonp(b,d,e,{cache:false})};this.handle_email_taken=function(b){if(b.emailTaken===true){this.update_status("This e-mail address is already registered. Use the forgot password link below or use a different e-mail.","error");this.$footer.showView({reset_password:true,start_over:true})}else{$j.tw(function(c){this.newsvine_login_using_twitter(c)},this)}};this.render_enter_resetpass=function(b){this.$enter_reset_form=b.$root;this.$enter_reset_form.append('<input type="email" class="email" name="email" placeholder="you@email.com" />');this.$enter_reset_form.append('<input type="submit" name="submit" value="Send Email" />');this.$enter_reset_form.submit(this,function(d){try{d.data.handle_enter_resetpass()}catch(c){$j.session.reportError(c)}return false});this.$enter_reset_form.showView=function(c){$form=this.show();$form.children("input.email").focus();if($j.util.validate_email(c)){$form.children("input.email").val(c)}}};this.handle_enter_resetpass=function(){var d=a("input.email",this.$enter_reset_form).val();if($j.util.validate_email(d)===false){this.update_status("Please enter a valid e-mail address.","error");return}var b=true;var c=$j.session.host.getResetPassUrl(d,$j.session.host.getUserDataUrl(b));$j.jsonp(c,this,function(e){this.view(this.VIEW_RESET_DONE)},{cache:false})};this.onView=function(b,d,c){this.bind("view_"+b,function(){d.call(c)})};this.view=function(b){this.clear_status();a("form",this.$root).hide();this.trigger("view_"+b);if(b===this.VIEW_CONNECT){this.$header.hide();this.$connect_form.showView();this.$footer.hide()}else{if(b===this.VIEW_ENTER_EMAIL){this.$header.showView(this.options.messages.email);this.$enter_email_form.showView();this.$footer.showView({reset_password:false,start_over:true})}else{if(b===this.VIEW_RESET_PASS){this.$header.showView(this.options.messages.reset_pass);this.$enter_reset_form.showView(this.get_user_email_input());this.$footer.showView({reset_password:false,register_new:true,start_over:true})}else{if(b===this.VIEW_RESET_DONE){this.$header.showView(this.options.messages.reset_done);this.$enter_reset_form.hide();this.$footer.showView({reset_password:false,register_new:true,start_over:true})}}}}}});a.fn.zinger_twitter=function(){return $j.PluginWrapper.handler($j.widget.Zinger.Twitter,this,arguments)}})(jQuery);(function(a){$j.namespace("$j.widget.fb");$j.widget.fb.Activity=$j.widget.AbstractWidget.extend(new function(){this.className="$j.widget.fb.Activity";this.getAssetPath=function(){return this._super().replace("/"+this.getWidgetName()+"/","/fb/")};if(a.browser.msie&&a.browser.version==="7.0"){var b=196}else{var b=185}this.options={assets:{css:true,template:true},title:"What my friends are reading & watching",not_sharing_likebox:{width:458,height:b},yes_sharing_likebox:{width:237,height:260},activity_feed:{width:450,height:280,toggle:false},fb_recommendations:{width:300,height:300},plugins:{like_button:false,recommend_button:false,recommendations:false,activity:false,sharing_like_box:false,not_sharing_like_box:false}};this.templates={};this.init=function(c){$j.session.ready(function(){this.set_plugin_options(c);this.init_options(c);a.extend(this.options,{domainRoot:$j.session.host.domainRoot,appId:$j.session.host.getFacebookConfig().appId,appHome:$j.session.host.getFacebookConfig().appHome});this.options.appHome=$j.session.host.getFacebookConfig().appHome;this.init_root_node(this.options);this.load(this.options.assets,function(d){if(d!==false){this.before_render_template(d);d=this.render_template(this.templates.root);this.after_render_template(d)}})},this)};this.set_plugin_options=function(c){if(c.edition==="cover"){this.options.plugins.like_button=true;this.options.plugins.recommendations=true;this.options.plugins.activity=true}else{if(c.edition==="story"){this.options.plugins.activity=true;this.options.plugins.sharing_like_box=true;this.options.plugins.not_sharing_like_box=true}else{if(c.edition==="video"){this.options.plugins.activity=true;this.options.plugins.recommend_button=true}}}};this.render_template=function(d,c,e){if(d!==false){c=c||this.$root;e=e||{};e.options=this.options;e.user=$j.session.user;var d=a.tmpl(d,e).appendTo(c)}return d};this.before_render_template=function(c){$nodes=c.children("code.template");for(var d=0;d<$nodes.length;d++){$node=a($nodes[d]).removeClass("template");var f=$node.attr("class");var e=$node.template();this.templates[f]=e}};this.after_render_template=function(d){$j.session.windowReady(function(){this.configureWidget($j.session.user);this.render_onload_plugins(this.$root);this.$root.find(".sharing_bar").fb_sharing(this.options).show()},this);var c=$j.session.user;c.onSharingSet(this,function(e){this.configureWidget(e)});c.onLogin(this,function(e){this.configureWidget(e)});if(this.options.activity_feed.toggle===true){this.$root.find(".j-title").click(this,function(e){e.preventDefault();e.data.handle_title_click()})}};this.render_onload_plugins=function(c){if(this.options.plugins.like_button===true){this.render_template(this.templates.like_button,c.find(".j-plugin-like-button"));c.find(".j-plugin-like-button").show()}this.parse(c)};this.parse=function(c){$j.fb(function(d){FB.XFBML.parse(c.get(0))})};this.render_recommend_button=function(c,d){var e=this.render_template(this.templates.recommend_button,c);if(typeof d==="string"){e.attr("data-href",d)}};this.recommend=function(d){var c=a.extend({empty:true,url:location.href,$node:this.$root.find(".recommend_button")},d||{});if(c.empty===true){c.$node.empty()}this.render_recommend_button(c.$node,c.url);this.parse(c.$node)};this.configureWidget=function(c){if(c.isFacebookSharing()===true){$j.fb(function(d){if(d.status==="connected"){this.showSharing()}else{this.hideSharing()}},this)}else{this.hideSharing()}};this.showSharing=function(){var c=this.options.plugins;if(c.activity===true){c.activity=false;this.render_template(this.templates.activity,this.$root.find(".j-plugin-activity"));this.$root.find(".j-plugin-activity").show()}if(c.sharing_like_box===true){c.sharing_like_box=false;this.render_template(this.templates.sharing_like_box,this.$root.find(".j-plugin-sharing-like-box"));this.$root.find(".j-plugin-sharing-like-box").show()}this.parse(this.$root.find(".fb_connected"));this.$root.removeClass("notSharing");this.$root.find(".fb_notConnected").hide();this.$root.find(".fb_connected").show()};this.hideSharing=function(){var c=this.options.plugins;if(c.recommend_button===true){c.recommend_button=false;this.render_recommend_button(this.$root.find(".j-plugin-recommend-button"));this.$root.find(".j-plugin-recommend-button").show()}if(c.recommendations===true){c.recommendations=false;this.render_template(this.templates.recommendations,this.$root.find(".j-plugin-recommendations"));this.$root.find(".j-plugin-recommendations").show()}if(c.not_sharing_like_box===true){c.not_sharing_like_box=false;this.render_template(this.templates.not_sharing_like_box,this.$root.find(".j-plugin-not-sharing-like-box"));this.$root.find(".j-plugin-not-sharing-like-box").show();this.$root.find(".hide_like").show()}this.parse(this.$root.find(".fb_notConnected"));this.$root.addClass("notSharing");this.$root.find(".fb_connected").hide();this.$root.find(".fb_notConnected").show()};this.handle_title_click=function(){this.toggle_activity()};this.toggle_activity=function(){this.$root.find(".fb-activity").toggle()}});a.fn.fb_activity=function(){return $j.PluginWrapper.handler($j.widget.fb.Activity,this,arguments)}})(jQuery);(function(a){$j.namespace("$j.widget.fb");$j.widget.fb.Sharing=$j.widget.AbstractWidget.extend(new function(){this.className="$j.widget.fb.Sharing";this.getAssetPath=function(){return this._super().replace("/"+this.getWidgetName()+"/","/fb/")};this.options={assets:{css:true,template:true},login:{edition:"networknav"},url:null,type:null,onAllow:function(b){},share_prompt_message:"Share what you're reading & see what your friends are viewing",sharing_message:"You're sharing this story on Facebook",confirm_message:"This story has been removed from your Facebook profile.",undo_label:"Undo",stop_label:"Stop all sharing"};this.templates={};this.init=function(b){this.init_options(b);this.init_root_node(this.options);this.load(this.options.assets,function(c){if(c!==false){this.before_render_template(c);c=this.render_template(this.templates.root);this.after_render_template(c)}})};this.render_template=function(c,b,d){if(c!==false){b=b||this.$root;d=d||{};d.options=this.options;d.user=$j.session.user;var c=a.tmpl(c,d).appendTo(b)}return c};this.before_render_template=function(b){$nodes=b.children("code.template");for(var c=0;c<$nodes.length;c++){$node=a($nodes[c]).removeClass("template");var e=$node.attr("class");var d=$node.template();this.templates[e]=d}};this.after_render_template=function(d){this.$prompt=this.$root.find(".j-share-prompt").removeClass("j-share-prompt").removeClass("c-hide").hide();this.$account=this.$root.find(".j-account").removeClass(".j-account").removeClass("c-hide").hide();var c={force_sharing:true,enable_sharing_checkbox:false,messages:{button_label:"Allow"},scope:this,connected_callback:function(g){if($j.session.user.isLoggedIn()===true){this.handle_allow_callback()}else{$j.session.user.onLogin(this,function(h){this.handle_allow_callback()})}}};this.$prompt.find(".j-fb-connect").zinger_facebook(c);var b=a.extend({target:{avatar_size:30,label:""}},this.options,{edition:this.options.login.edition});this.$root.find(".j-zinger-login").zinger_login(b);this.$account.find(".j-undo").click(this,function(g){g.preventDefault();g.data.handle_undo_click()});this.$account.find(".j-stopall").click(this,function(g){g.preventDefault();g.data.handle_stopall_click()});this.toggle();$j.session.user.onLogin(this,function(g){this.toggle()});$j.session.user.onSharingSet(this,function(g){this.toggle()});var f=$j.session.host.domainRootLabel;if(f==="TODAY"){var e="http://today.msnbc.msn.com/id/46329902"}else{if(f==="msnbc.com"){var e="http://www.msnbc.msn.com/id/46385532"}}this.$root.find(".j-what").attr("href",e)};this.toggle=function(b){b=b||false;if($j.session.user.isFacebookSharing()===false||b===true){this.$account.hide();this.$prompt.show()}else{$j.fb(function(c){if(c.status==="connected"){this.$prompt.hide();this.$account.show()}else{this.$account.hide();this.$prompt.show()}},this)}};this.handle_undo_click=function(){this.$account.find(".j-sharing-message").hide();this.$account.find(".j-undo").hide();this.$account.find(".j-confirm-message").show();this.unshare_item()};this.handle_stopall_click=function(){$j.session.user.setSharing(false);this.unshare_item();this.toggle()};this.handle_allow_callback=function(){if(typeof this.options.onAllow==="function"){this.options.onAllow.call(this,$j.session.user)}else{if(typeof this.options.url!=="string"){this.options.url=location.href}if(typeof this.options.type!=="string"){this.options.type="article"}$j.session.user.share({type:this.options.type,url:this.options.url,connected:{callback:function(b){$j.log("you shared!",this.options.url,b)}}})}};this.unshare_item=function(){$j.session.user.unshare({})}});a.fn.fb_sharing=function(){return $j.PluginWrapper.handler($j.widget.fb.Sharing,this,arguments)}})(jQuery);